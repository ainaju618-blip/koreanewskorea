# 스크래퍼 관리 페이지 개선 계획서

> **작성일:** 2025-12-12
> **작성자:** AI Agent
> **대상 파일:** `web/src/app/admin/bot/run/page.tsx`
> **상태:** 계획 단계

---

## 1. 현황 분석

### 1.1 현재 구조
```
┌────────────────────────────────────────────────────────────┐
│  자동 수집 스케줄러 (ON/OFF)                               │
├────────────────────────────────────────────────────────────┤
│  수집 조건 설정 (수동)                                      │
│  - 수집 기간 설정                                          │
│  - 수집 대상 지역 및 기관 체크박스                         │
│  - [수집 시작] [Dry Run] 버튼                              │
└────────────────────────────────────────────────────────────┘
```

### 1.2 문제점
1. **중복 기사 문제**: 이미 DB에 있는 기사가 있으면 스크래퍼가 중복 체크로 스킵됨
2. **테스트 어려움**: 스크래퍼 테스트 시 기존 데이터를 수동으로 삭제해야 함
3. **데이터 관리 부재**: 지역별 기사 현황을 볼 수 없음

---

## 2. 개선 목표

### 2.1 화면 분할 구조
```
┌──────────────────────────────┬──────────────────────────────┐
│       왼쪽: 스크래퍼 실행      │      오른쪽: DB 관리          │
├──────────────────────────────┼──────────────────────────────┤
│  수집 기간 설정               │  지역별 기사 현황             │
│  지역 선택 체크박스           │  지역 선택 체크박스           │
│  [수집 시작] [Dry Run]       │  [선택 지역 기사 삭제]        │
│                              │  (기간 선택 옵션)             │
│  실행 상태/결과               │  삭제 결과 표시               │
└──────────────────────────────┴──────────────────────────────┘
```

### 2.2 워크플로우
```
1. 오른쪽에서 테스트할 지역 선택
2. 해당 지역의 기존 기사 삭제
3. 왼쪽에서 같은 지역 선택
4. 스크래퍼 실행
5. 결과 확인
```

---

## 3. 상세 설계

### 3.1 왼쪽 패널 (기존 유지 + 개선)

**구성 요소:**
- 자동 수집 스케줄러 ON/OFF (상단 공통)
- 수집 기간 설정 (기존 유지)
- 지역 선택 체크박스 (기존 유지)
- 실행 버튼: [수집 시작] [Dry Run]
- 실행 상태 표시 (기존 유지)

### 3.2 오른쪽 패널 (신규)

**구성 요소:**

#### A. 지역별 기사 현황 (선택 사항 - 간략 버전)
```tsx
// 각 지역별 기사 수 표시 (간략)
interface RegionStats {
    region: string;
    regionLabel: string;
    count: number;
    latestDate: string | null;
}
```

#### B. 지역 선택 체크박스
- 왼쪽과 동일한 지역 목록
- 다중 선택 가능
- [전체 선택] [전체 해제] 버튼

#### C. 삭제 옵션
```tsx
// 삭제 조건
interface DeleteOptions {
    regions: string[];           // 선택된 지역 코드 배열
    dateRange?: {
        startDate: string;       // 선택적: 특정 기간만 삭제
        endDate: string;
    };
    status?: string[];           // 선택적: 특정 상태만 (draft, published 등)
}
```

#### D. 삭제 확인 모달
```
┌─────────────────────────────────────────┐
│  ⚠️ 기사 삭제 확인                       │
├─────────────────────────────────────────┤
│  다음 지역의 기사를 삭제합니다:         │
│  - 여수시: 15건                         │
│  - 순천시: 23건                         │
│  - 나주시: 8건                          │
│                                         │
│  총 46건이 영구 삭제됩니다.             │
│  이 작업은 되돌릴 수 없습니다.          │
│                                         │
│  [취소]              [삭제 실행]        │
└─────────────────────────────────────────┘
```

---

## 4. API 설계

### 4.1 기존 API (활용)
- `GET /api/posts` - 기사 목록 조회 (region 필터 추가 필요)

### 4.2 신규 API

#### A. 지역별 기사 통계
```
GET /api/posts/stats/by-region
```

**Response:**
```json
{
    "stats": [
        { "region": "yeosu", "count": 15, "latestDate": "2025-12-12" },
        { "region": "suncheon", "count": 23, "latestDate": "2025-12-11" },
        { "region": "naju", "count": 8, "latestDate": "2025-12-10" }
    ],
    "total": 46
}
```

#### B. 지역별 기사 삭제
```
DELETE /api/posts/bulk-delete
```

**Request Body:**
```json
{
    "regions": ["yeosu", "suncheon"],
    "dateRange": {
        "startDate": "2025-12-01",
        "endDate": "2025-12-12"
    }
}
```

**Response:**
```json
{
    "success": true,
    "deleted": {
        "yeosu": 15,
        "suncheon": 23
    },
    "totalDeleted": 38
}
```

---

## 5. 데이터베이스 고려사항

### 5.1 현재 posts 테이블 구조 (확인 필요)
- `source` 컬럼: 지역명 (한글, 예: "여수시")
- `region` 컬럼: 지역 코드 (영문, 예: "yeosu") - 있는지 확인 필요

### 5.2 지역 매핑
```typescript
// 스크래퍼 region 코드 → DB source 매핑
const regionMapping = {
    "yeosu": "여수시",
    "suncheon": "순천시",
    "naju": "나주시",
    // ... 전체 27개 지역
};
```

---

## 6. 컴포넌트 구조

### 6.1 파일 구조
```
web/src/app/admin/bot/run/
├── page.tsx              # 메인 페이지 (기존 수정)
├── components/
│   ├── ScraperPanel.tsx  # 왼쪽: 스크래퍼 실행 패널
│   ├── DbManagerPanel.tsx # 오른쪽: DB 관리 패널
│   ├── RegionCheckbox.tsx # 공통: 지역 체크박스 컴포넌트
│   └── DeleteConfirmModal.tsx # 삭제 확인 모달
```

### 6.2 공통 컴포넌트 활용
```tsx
import {
    ConfirmModal,     // 삭제 확인
    FilterTabs,       // 상태 필터 (옵션)
    PageHeader,       // 페이지 헤더
} from "@/components/admin/shared";
```

---

## 7. 구현 단계

### Phase 1: API 구현 (1-2시간)
1. posts 테이블 region 컬럼 확인
2. `GET /api/posts/stats/by-region` API 생성
3. `DELETE /api/posts/bulk-delete` API 생성

### Phase 2: 컴포넌트 분리 (1시간)
1. 기존 page.tsx에서 ScraperPanel 분리
2. RegionCheckbox 공통 컴포넌트 생성

### Phase 3: DB 관리 패널 구현 (2시간)
1. DbManagerPanel 컴포넌트 생성
2. 지역별 통계 표시
3. 삭제 기능 구현
4. DeleteConfirmModal 연동

### Phase 4: 레이아웃 통합 (1시간)
1. 2단 레이아웃 적용
2. 반응형 디자인 (모바일: 세로 배치)
3. 스타일 통일

### Phase 5: 테스트 및 검증 (1시간)
1. 삭제 기능 테스트
2. 스크래퍼 연동 테스트
3. Edge case 처리

---

## 8. 예상 결과물

### 8.1 UI 미리보기
```
┌─────────────────────────────────────────────────────────────────────────┐
│  🤖 수동 수집 실행                                                       │
│  원하는 지역과 기간을 선택하여 즉시 뉴스를 수집할 수 있습니다.            │
├─────────────────────────────────────────────────────────────────────────┤
│  자동 수집 스케줄러: ON (자동 실행 중)                        [토글]     │
├────────────────────────────────┬────────────────────────────────────────┤
│  📥 스크래퍼 실행               │  🗑️ DB 관리 (기사 삭제)                │
├────────────────────────────────┼────────────────────────────────────────┤
│  수집 기간:                     │  지역별 기사 현황:                      │
│  [2025-12-12] ~ [2025-12-12]   │  □ 여수시 (15건) - 최근: 12/12         │
│  [오늘][1일][2일][3일][1주]    │  □ 순천시 (23건) - 최근: 12/11         │
│                                │  □ 나주시 (8건) - 최근: 12/10          │
│  교육기관:                      │  □ 광주광역시 (0건)                    │
│  □ 광주교육청  □ 전남교육청     │  ...                                   │
│                                │                                        │
│  지자체:                        │  삭제 옵션:                             │
│  □ 광주  □ 전남  □ 나주        │  기간: [전체] [최근 7일] [최근 30일]    │
│  □ 여수  □ 순천  □ 광양  ...   │                                        │
│                                │  [전체 선택] [전체 해제]                │
│  [전체 선택] [전체 해제]        │                                        │
│                                │  ⚠️ 3개 지역, 46건 선택됨               │
│  [▶ 수집 시작] [Dry Run]       │  [🗑️ 선택 지역 기사 삭제]              │
└────────────────────────────────┴────────────────────────────────────────┘
```

---

## 9. 주의사항

### 9.1 안전장치
- 삭제 전 반드시 확인 모달 표시
- 삭제 건수 미리 표시
- 삭제 작업 로깅

### 9.2 성능 고려
- 대량 삭제 시 배치 처리
- 통계 조회 캐싱 (선택적)

### 9.3 권한 체크
- 관리자만 삭제 가능 (기존 인증 활용)

---

## 10. 승인 요청

주인님, 위 계획대로 진행해도 될까요?

**예상 작업 시간:** 약 6-7시간
**우선 구현:** Phase 1-3 (핵심 기능)
**후순위:** Phase 4-5 (UI 개선 및 테스트)

승인해 주시면 Phase 1부터 진행하겠습니다.
