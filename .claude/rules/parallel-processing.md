# 병렬 처리 규칙 (Parallel Processing Rules)

> Version: 1.0
> Last Updated: 2026-01-02

---

## 핵심 원칙 (P0 - 절대 규칙)

```
┌─────────────────────────────────────────────────────────────┐
│  병렬 처리 = "의존성 분석 → 그룹화 → 병렬 실행"             │
│                                                              │
│  ❌ 무작정 병렬 실행 금지                                    │
│  ✅ 반드시 그룹화 후 병렬 실행                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 병렬 처리 3단계 프로세스 (MUST)

### Step 1: 분석 & 그룹화 (필수!)

```
사용자: "병렬 처리해줘" / "병렬로 작업해줘"

AI 응답:
1. 작업 항목 전체 파악
2. 의존성 분석 수행
3. 충돌 없는 그룹으로 분리

그룹화 기준:
- 같은 파일 수정 → 같은 그룹
- 같은 컴포넌트 의존 → 같은 그룹
- 순차 실행 필요 → 같은 그룹
- 완전 독립 작업 → 다른 그룹 (병렬 가능)
```

### Step 2: 병렬 실행

```
그룹화 완료 후:
- 그룹 수만큼 서브에이전트 생성
- 각 그룹을 독립적으로 병렬 처리
- 결과는 요약만 반환하도록 지시
```

### Step 3: 검증 & 수정

```
병렬 실행 완료 후:
- 실패한 항목만 식별
- 실패 항목에 대해서만 병렬 수정
- 전체 결과 요약 보고
```

---

## 제한 사항 (Limits)

| 항목 | 권장값 | 최대값 | 이유 |
|------|--------|--------|------|
| 동시 서브에이전트 | 5-8개 | 12개 | 컨텍스트 오버플로우 방지 |
| 그룹당 작업 수 | 3-5개 | 10개 | 에이전트 부하 분산 |
| 단계별 실행 | 필수 | - | 의존성 충돌 방지 |

---

## 프롬프트 템플릿

### 사용자가 "병렬 처리해줘"라고 하면:

```markdown
## 1단계: 분석 & 그룹화

작업을 분석하여 의존성이 겹치지 않는 그룹으로 분리합니다.

**그룹화 결과:**
- 그룹 1: [작업 A, B] - 독립적
- 그룹 2: [작업 C, D] - 독립적
- 그룹 3: [작업 E, F, G] - E→F→G 순차 필요

**병렬 가능:** 그룹 1, 2, 3 (3개 서브에이전트)
**순차 필요:** 그룹 3 내부 작업

## 2단계: 병렬 실행

그룹별로 서브에이전트를 띄워서 병렬 처리합니다.
```

### 서브에이전트 호출 시 필수 지시:

```
"결과는 요약해서 반환해줘.
 전체 파일 내용 대신 변경 사항만 보고해.
 성공/실패 여부와 핵심 결과만 포함해."
```

---

## 안티패턴 (하지 말 것)

| 안티패턴 | 문제점 | 올바른 방법 |
|----------|--------|-------------|
| 그룹화 없이 바로 병렬 | 의존성 충돌, 파일 덮어쓰기 | 그룹화 먼저 |
| 20개+ 동시 에이전트 | 컨텍스트 오버플로우 | 12개 이하 |
| 전체 결과 반환 | 메인 컨텍스트 폭발 | 요약만 반환 |
| 한 번에 모든 단계 | 제어 불가, 디버깅 어려움 | 단계별 실행 |

---

## 실전 예시

### 예시 1: 10개 파일 수정

```
사용자: "이 10개 파일을 병렬로 수정해줘"

AI 프로세스:
1. 파일 간 의존성 분석
   - file1, file2 → 같은 모듈 import (그룹 1)
   - file3, file4, file5 → 독립적 (그룹 2)
   - file6~10 → 독립적 (그룹 3, 4, 5)

2. 그룹화 결과 보고
   - "5개 그룹으로 분리했습니다. 병렬 실행할까요?"

3. 승인 후 5개 서브에이전트 병렬 실행

4. 결과 요약 보고
```

### 예시 2: 테스트 코드 생성

```
사용자: "50개 테스트 시나리오 병렬로 작성해줘"

AI 프로세스:
1. 시나리오 의존성 분석
   - 같은 페이지 테스트 → 같은 그룹
   - 상태 공유 테스트 → 같은 그룹

2. 10-12개 그룹으로 분리

3. 12개 서브에이전트 병렬 실행

4. 실패 테스트 → 힐러 에이전트로 수정
```

---

## 컨텍스트 관리

```
서브에이전트 특성:
┌─────────────────────────────────────────────────────────────┐
│  - 각 서브에이전트는 독립적인 컨텍스트 윈도우 보유          │
│  - 메인 에이전트 컨텍스트를 침범하지 않음                   │
│  - 단, 결과 반환 시 메인 컨텍스트에 누적됨                  │
│                                                              │
│  → 결과를 요약해서 반환하도록 지시 필수!                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 에러 복구

### "컨텍스트 너무 큼" 에러 발생 시:

```
1. /clear 또는 새 세션 시작
2. 작업을 더 작은 단위로 분할
3. 동시 에이전트 수 줄이기 (5개 이하)
4. 결과 요약 지시 강화
```

---

## 체크리스트

병렬 처리 요청 시 AI가 확인할 항목:

- [ ] 의존성 분석 완료?
- [ ] 그룹화 완료?
- [ ] 동시 에이전트 12개 이하?
- [ ] 결과 요약 반환 지시?
- [ ] 단계별 실행 계획?

---

*Reference: 개발동생 유튜브 - Claude Code 서브에이전트 활용법*
