# Backend Data Directory

ì£¼ì—­(I Ching) ê¸°ë°˜ ì ìˆ  ì‹œìŠ¤í…œì˜ ëª¨ë“  ì •ì  ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤.

## ğŸ“Š íŒŒì¼ ëª©ë¡

### 1. JSON ë°ì´í„° íŒŒì¼ (í”„ë¡œë•ì…˜ ë°ì´í„°)

#### `questions_unified.json`
- **ìš©ë„**: í†µí•© ì§ˆë¬¸ ë°ì´í„°ì…‹
- **í¬ê¸°**: ~4MB
- **êµ¬ì„±**: 9,491ê°œ ì§ˆë¬¸ + ë©”íƒ€ë°ì´í„°
- **ìƒì„±**: `scripts/parse_questions.py` ì‹¤í–‰
- **êµ¬ì¡°**:
  ```json
  {
    "version": "1.0.0",
    "generated_at": "2025-12-31T18:33:50.519135",
    "total_count": 9491,
    "statistics": {
      "by_category": { "ì§ì—…": 1000, "ì¬ë¬¼": 1998, ... },
      "by_file": [{ "file": "...", "count": ... }]
    },
    "questions": [
      {
        "id": "Q00001",
        "text": "ì§ˆë¬¸ ë‚´ìš©?",
        "major_category_id": 1,
        "major_category_name": "ì¬ë¬¼",
        "sub_category": "ì¬ë¬¼ìš´",
        "keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"],
        "source_file": "questions_money_500.txt",
        "line_number": 42,
        "original_number": 1
      }
    ]
  }
  ```
- **ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜**:
  - ì¬ë¬¼ (1): 1,998ê°œ - ì¬ë¬¼ìš´, ì°½ì—…/ì‚¬ì—…, íˆ¬ì, ë¶€ë™ì‚°/ì´ì‚¬
  - ì§ì—… (2): 1,000ê°œ - ì·¨ì—…/ë©´ì ‘, ì´ì§/ìŠ¹ì§„
  - í•™ì—… (3): 500ê°œ
  - ì—°ì•  (4): 1,000ê°œ - ì—°ì• , ê²°í˜¼
  - ëŒ€ì¸ (5): 1,000ê°œ - ì¸ê°„ê´€ê³„, ì‚¬íšŒìƒí™œ
  - ê±´ê°• (6): 994ê°œ - ê±´ê°•/ê°€ì¡±, ìœ¡ì•„/ë¶€ëª¨
  - ì·¨ë¯¸ (7): 1,000ê°œ - ì·¨ë¯¸/ì—¬ê°€, ì—¬í–‰
  - ìš´ëª… (8): 1,499ê°œ - ìš´ëª…/ì „ìƒ, ì¼ìƒì„ íƒ, ì˜¤ëŠ˜ìš´ì„¸
  - ê¸°íƒ€ (9): 500ê°œ - ë²•ë¥ /ë¶„ìŸ

#### `keywords_index.json`
- **ìš©ë„**: ì—­ì¸ë±ìŠ¤ (ì§ˆë¬¸ ê²€ìƒ‰ ìµœì í™”)
- **í¬ê¸°**: ~1.8MB
- **êµ¬ì„±**: 9,975ê°œ í‚¤ì›Œë“œ + ê´€ë ¨ ì§ˆë¬¸ ID ëª©ë¡
- **ìƒì„±**: `scripts/build_index.py` ì‹¤í–‰
- **êµ¬ì¡°**:
  ```json
  {
    "ë²„ìŠ¤": ["Q00123", "Q00456", ...],
    "ì‚¬ì—…": ["Q00001", "Q00234", ...],
    "ì·¨ì§": ["Q00789", ...],
    ...
  }
  ```
- **ìš©ë„**:
  - ì‚¬ìš©ì ì§ˆë¬¸ ê²€ìƒ‰
  - RAG (Retrieval-Augmented Generation) ë§¤ì¹­
  - ì¶”ì²œ ì‹œìŠ¤í…œ ê¸°ë°˜ ì œê³µ

#### `category_questions_map.json`
- **ìš©ë„**: ì¹´í…Œê³ ë¦¬ë³„ ì§ˆë¬¸ ë§¤í•‘ (ë¹ ë¥¸ ì¡°íšŒ)
- **í¬ê¸°**: ~1.5MB
- **êµ¬ì„±**: 9ê°œ ëŒ€ë¶„ë¥˜ Ã— 250ê°œ ì†Œë¶„ë¥˜
- **ìƒì„±**: `scripts/parse_questions.py` ë° ì¶”ê°€ ì²˜ë¦¬
- **êµ¬ì¡°**:
  ```json
  {
    "1": {
      "major_name": "ì¬ë¬¼",
      "sub_categories": {
        "ì¬ë¬¼ìš´": ["Q00001", "Q00002", ...],
        "ì°½ì—…/ì‚¬ì—…": ["Q00100", ...],
        "íˆ¬ì": ["Q00200", ...],
        "ë¶€ë™ì‚°/ì´ì‚¬": ["Q00300", ...]
      }
    },
    ...
  }
  ```

### 2. Python ë°ì´í„° íŒŒì¼ (ìŠ¤í¬ë¦½íŠ¸)

#### `hexagram_complete.py`
- **ìš©ë„**: 64ê´˜(Hexagram) ì™„ì „ ë°ì´í„°
- **êµ¬ì„±**: 64ê°œ ê´˜ ì •ë³´ + 8ê°œ ì†Œì„±ê´˜(Trigram) ì •ë³´
- **ì£¼ìš” ë‚´ìš©**:
  ```python
  TRIGRAM_INFO = {
      0: {"name_ko": "ê³¤", "name_hanja": "å¤", "symbol": "â˜·", "nature": "ë•…"},
      1: {"name_ko": "ì§„", "name_hanja": "éœ‡", "symbol": "â˜³", "nature": "ìš°ë ˆ"},
      ...
  }

  HEXAGRAM_DATA = {
      1: {
          "number": 1,
          "name_ko": "ê±´",
          "name_hanja": "ä¹¾",
          "upper_trigram": 7,  # ê±´(ä¹¾)
          "lower_trigram": 7,  # ê±´(ä¹¾)
          "gua_ci": "ì›í˜•ì´ì •... (ê´˜ì‚¬)"
      },
      ...
  }
  ```
- **ìš©ë„**: ì ìˆ  ê²°ê³¼ì˜ ê´˜ ì •ë³´ ì¡°íšŒ

#### `yao_complete.py`
- **ìš©ë„**: 384íš¨(Line Interpretations) ì™„ì „ ë°ì´í„°
- **êµ¬ì„±**: 384ê°œ íš¨ í•´ì„ (64ê´˜ Ã— 6íš¨)
- **í¬ê¸°**: ~187KB
- **ì£¼ìš” êµ¬ì¡°**:
  ```python
  YAO_DATA = {
      (1, 1): {"text": "..."},  # (ê´˜ ë²ˆí˜¸, íš¨ ìœ„ì¹˜)
      (1, 2): {"text": "..."},
      ...
  }
  ```
- **ìš©ë„**: ê° ê´˜ì˜ ê°œë³„ íš¨(ë³€ê´˜) í•´ì„

#### `category_seed.py`
- **ìš©ë„**: 250ê°œ ì„¸ë¶€ ì¹´í…Œê³ ë¦¬ ë§ˆìŠ¤í„° ë°ì´í„°
- **í¬ê¸°**: ~44KB
- **êµ¬ì„±**:
  ```python
  CATEGORIES = {
      "1.1": {"id": "1.1", "major": "ì¬ë¬¼", "sub": "ì¬ë¬¼ìš´", "keywords": [...]},
      "1.2": {"id": "1.2", "major": "ì¬ë¬¼", "sub": "ì°½ì—…/ì‚¬ì—…", ...},
      ...
  }
  ```
- **ìš©ë„**: ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ë° ì§ˆë¬¸ ë¶„ë¥˜

#### `daily_fortune_final.py` & `daily_fortune_generated.py`
- **ìš©ë„**: ì¼ì¼ ìš´ì„¸ ë°ì´í„°
- **í¬ê¸°**: ~66KB (final) / ~209KB (generated)
- **êµ¬ì„±**: ì¼ì¼ ìš´ì„¸ ê²°ê³¼ ë° í•´ì„
- **ìš©ë„**: ì‚¬ìš©ì ì¼ì¼ ìš´ì„¸ ì œê³µ

#### `yao_export.json`
- **ìš©ë„**: 384íš¨ ë°ì´í„°ì˜ JSON ë‚´ë³´ë‚´ê¸° í˜•ì‹
- **í¬ê¸°**: ~157KB
- **ìš©ë„**: API ì‘ë‹µ ë° í”„ë¡ íŠ¸ì—”ë“œ ì œê³µ

#### `interpretation_matrix.py`
- **ìš©ë„**: ê´˜-ì¹´í…Œê³ ë¦¬ í•´ì„ ë§¤íŠ¸ë¦­ìŠ¤
- **í¬ê¸°**: ~13KB
- **êµ¬ì„±**: ê° ê´˜ì™€ ì¹´í…Œê³ ë¦¬ ì¡°í•©ì— ëŒ€í•œ í•´ì„
- **ìš©ë„**: ë§¥ë½ì— ë§ëŠ” ê´˜ í•´ì„ ì œê³µ

#### `fortune_direction.py` / `yao_direction.py` / `question_direction.py`
- **ìš©ë„**: ë°©í–¥ì„±(å‰/å‡¶) ë° ì¡°ì–¸ ë°ì´í„°
- **í¬ê¸°**: ~18-20KB ê°ê°
- **êµ¬ì„±**: ì ìˆ  ê²°ê³¼ì— ëŒ€í•œ ë°©í–¥ì„± ì œì‹œ
- **ìš©ë„**: ì‚¬ìš©ìì—ê²Œ ê¸ì •ì /ë¶€ì •ì  ë©”ì‹œì§€ ì „ë‹¬

#### `psychology_patterns.py`
- **ìš©ë„**: ì‹¬ë¦¬ íŒ¨í„´ ë° í–‰ë™ ê³¼í•™ ë°ì´í„°
- **í¬ê¸°**: ~18KB
- **êµ¬ì„±**: ì£¼ì—­ í•´ì„ê³¼ ì‹¬ë¦¬í•™ì˜ ì—°ê²° ê³ ë¦¬
- **ìš©ë„**: ê³¼í•™ì  ê·¼ê±° ê¸°ë°˜ í•´ì„ ì œê³µ

#### `interpretations_seed.py` & `user_questions_seed.py`
- **ìš©ë„**: ì´ˆê¸° í•´ì„ í…œí”Œë¦¿ ë° ì‚¬ìš©ì ì§ˆë¬¸ ì˜ˆì‹œ
- **í¬ê¸°**: ~38KB (interpretations) / ~14KB (user_questions)
- **ìš©ë„**: AI ëª¨ë¸ í•™ìŠµ ë° ì‘ë‹µ í…œí”Œë¦¿

### 3. CSV í…œí”Œë¦¿ íŒŒì¼

#### `384yao_template.csv`
- **ìš©ë„**: 384íš¨ ë°ì´í„° í¸ì§‘ìš© í…œí”Œë¦¿
- **í¬ê¸°**: ~6KB
- **êµ¬ì„±**:
  ```csv
  hexagram_id,yao_position,yao_text,attribute,meaning
  1,1,"ì´ˆêµ¬...",ì–‘,ê¸ì •
  1,2,"ìœ¡ì´...",ì–‘,ì¤‘ë¦½
  ...
  ```
- **ìš©ë„**: ë°ì´í„° ê²€ì¦ ë° ëŒ€ëŸ‰ í¸ì§‘

## ğŸ”„ ë°ì´í„° ìƒì„± ë° ê°±ì‹  ì ˆì°¨

### 1. ì§ˆë¬¸ ë°ì´í„° íŒŒì‹±
```bash
cd backend
python scripts/parse_questions.py
```
- **ì…ë ¥**: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ 19ê°œ TXT íŒŒì¼
- **ì¶œë ¥**: `app/data/questions_unified.json`
- **ì—­í• **:
  - ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì¶”ì¶œ
  - í‚¤ì›Œë“œ ìë™ ì¶”ì¶œ
  - ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
  - ë©”íƒ€ë°ì´í„° ìƒì„±

### 2. í‚¤ì›Œë“œ ì¸ë±ìŠ¤ ìƒì„±
```bash
cd backend
python scripts/build_index.py
```
- **ì…ë ¥**: `questions_unified.json`
- **ì¶œë ¥**: `app/data/keywords_index.json`
- **ì—­í• **:
  - ì—­ì¸ë±ìŠ¤ êµ¬ì¶•
  - ê²€ìƒ‰ ìµœì í™”
  - RAG ê¸°ë°˜ ë§¤ì¹­ ì¤€ë¹„

### 3. ì¼ì¼ ìš´ì„¸ ìƒì„±
```bash
cd backend
python scripts/generate_daily_fortune.py
```
- **ì…ë ¥**: ê´˜ ë°ì´í„°, í•´ì„ ë°ì´í„°
- **ì¶œë ¥**: `app/data/daily_fortune_generated.py`
- **ì—­í• **: ë§¤ì¼ ìƒˆë¡œìš´ ìš´ì„¸ ë°ì´í„° ìƒì„±

## ğŸ“ ë°ì´í„° ìŠ¤í‚¤ë§ˆ

### ì§ˆë¬¸ ê°ì²´
```python
{
    "id": str,                    # "Q00001"
    "text": str,                  # ì§ˆë¬¸ í…ìŠ¤íŠ¸
    "major_category_id": int,     # 1-9
    "major_category_name": str,   # "ì¬ë¬¼", "ì§ì—…" ë“±
    "sub_category": str,          # "ì¬ë¬¼ìš´", "ì°½ì—…/ì‚¬ì—…" ë“±
    "keywords": List[str],        # ì¶”ì¶œëœ í‚¤ì›Œë“œ (ìµœëŒ€ 10ê°œ)
    "source_file": str,           # "questions_money_500.txt"
    "line_number": int,           # ì›ë³¸ íŒŒì¼ í–‰ ë²ˆí˜¸
    "original_number": int        # ì›ë³¸ íŒŒì¼ ë‚´ ì¼ë ¨ë²ˆí˜¸
}
```

### ê´˜(Hexagram) ê°ì²´
```python
{
    "number": int,                # 1-64
    "name_ko": str,               # "ê±´", "ê³¤" ë“±
    "name_hanja": str,            # "ä¹¾", "å¤" ë“±
    "name_full": str,             # "ê±´ìœ„ì²œ", "ê³¤ìœ„ì§€" ë“±
    "upper_trigram": int,         # 0-7
    "lower_trigram": int,         # 0-7
    "gua_ci": str                 # ê´˜ì‚¬(ê´˜ì— ëŒ€í•œ ì„¤ëª…)
}
```

### íš¨(Line) ê°ì²´
```python
{
    "hexagram_id": int,           # 1-64
    "position": int,              # 1-6 (ìœ„ì¹˜)
    "text": str,                  # íš¨ í•´ì„ í…ìŠ¤íŠ¸
    "attribute": str,             # "ì–‘" ë˜ëŠ” "ìŒ"
    "meaning": str,               # "ê¸¸", "í‰", "ì¤‘" ë“±
}
```

## ğŸ” ë°ì´í„° ê²€ì¦

### í†µí•©ì„± í™•ì¸
```bash
# ì „ì²´ ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
pytest tests/test_api_endpoints.py -v

# ì¹´í…Œê³ ë¦¬ ê²€ì¦
pytest tests/test_category_matcher.py -v

# ì¸ë±ìŠ¤ ê²€ì¦
pytest tests/test_rag_matching.py -v
```

## ğŸ“¦ ì‚¬ìš© ì˜ˆì‹œ

### Pythonì—ì„œ ë°ì´í„° ë¡œë“œ
```python
import json

# ì§ˆë¬¸ ë°ì´í„° ë¡œë“œ
with open('app/data/questions_unified.json', 'r', encoding='utf-8') as f:
    questions = json.load(f)
    print(f"Total questions: {questions['total_count']}")

# í‚¤ì›Œë“œ ì¸ë±ìŠ¤ ë¡œë“œ
with open('app/data/keywords_index.json', 'r', encoding='utf-8') as f:
    index = json.load(f)
    print(f"Total keywords: {len(index)}")

# ê´˜ ë°ì´í„° ë¡œë“œ
from app.data.hexagram_complete import HEXAGRAM_DATA
print(f"Total hexagrams: {len(HEXAGRAM_DATA)}")

# íš¨ ë°ì´í„° ë¡œë“œ
from app.data.yao_complete import YAO_DATA
print(f"Total yao (lines): {len(YAO_DATA)}")
```

### API ì—”ë“œí¬ì¸íŠ¸ì—ì„œì˜ í™œìš©
- `/api/divination`: ê´˜ ë° í•´ì„ ì¡°íšŒ
- `/api/divination/categories`: ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë°˜í™˜
- `/api/divination/search`: í‚¤ì›Œë“œ ê²€ìƒ‰ (keywords_index.json í™œìš©)

## âš™ï¸ ë°ì´í„° ê´€ë¦¬ íŒ

1. **ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬**: JSON íŒŒì¼ì€ ~4MBì´ë¯€ë¡œ ì²« ë¡œë“œ ì‹œ ì•½ê°„ì˜ ì§€ì—° ë°œìƒ ê°€ëŠ¥
   â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ê±°ë‚˜ ìºì‹± ê¶Œì¥

2. **ë²„ì „ ê´€ë¦¬**: `questions_unified.json`ì˜ `version` í•„ë“œë¡œ ë²„ì „ ì¶”ì 

3. **ë°±ì—…**: Python íŒŒì¼ë“¤(`.py`)ì€ ë³€ê²½ ë¶ˆê°€ ìŠ¤í¬ë¦½íŠ¸ë¡œ ê´€ë¦¬
   â†’ ìˆ˜ì • í•„ìš” ì‹œ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì • í›„ ì¬ìƒì„±

4. **ì—…ë°ì´íŠ¸ ì£¼ê¸°**:
   - ì§ˆë¬¸ ë°ì´í„°: í•„ìš” ì‹œ TXT íŒŒì¼ ì¶”ê°€ í›„ `parse_questions.py` ì‹¤í–‰
   - ì¸ë±ìŠ¤: `build_index.py` ìë™ ì‹¤í–‰
   - ì¼ì¼ ìš´ì„¸: ë§¤ì¼ `generate_daily_fortune.py` ì‹¤í–‰ ê¶Œì¥

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

- **JSON ì••ì¶•**: gzip ì‚¬ìš©ìœ¼ë¡œ íŒŒì¼ í¬ê¸° 50% ê°ì†Œ ê°€ëŠ¥
- **ë©”ëª¨ë¦¬ ë¡œë“œ**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì£¼ìš” ë°ì´í„° ë©”ëª¨ë¦¬ì— ë¡œë“œ
- **ìºì‹±**: Redis ë“±ìœ¼ë¡œ ìì£¼ ì¡°íšŒë˜ëŠ” ë°ì´í„° ìºì‹±
- **ì¸ë±ì‹±**: SQLite/PostgreSQLë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-01-01
**ê´€ë¦¬ì**: Backend Team
