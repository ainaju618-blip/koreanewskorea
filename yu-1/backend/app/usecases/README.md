# UseCase íŒ¨í„´ ë¬¸ì„œ

## ê°œìš”

**UseCase ê³„ì¸µ**ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì¡°í•©ì„ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ê³„ì¸µì…ë‹ˆë‹¤. Repository, Service, ì™¸ë¶€ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì¡°ìœ¨í•˜ì—¬ ì™„ì „í•œ ë„ë©”ì¸ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### ì±…ì„
- Repositoryì—ì„œ ë°ì´í„° ì¡°íšŒ
- Serviceì—ì„œ ì ìˆ  ìˆ˜í–‰
- AI í•´ì„ ê°€ì´ë“œë¼ì¸ ê¸°ë°˜ ì ìˆ  í•´ì„ ìƒì„±
- LLM ì–´íˆ¬ ë³€í™˜ ì²˜ë¦¬
- ìµœì¢… ê²°ê³¼ ì¡°í•© ë° DTO ë°˜í™˜

### êµ¬ì¡°
```
usecases/
â”œâ”€â”€ __init__.py              # ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ export
â””â”€â”€ divination_usecase.py    # ì ìˆ  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
```

---

## DivinationUseCase

### ëª©ì 

ì‚¬ìš©ì ì§ˆë¬¸ â†’ ì ìˆ  ê²°ê³¼ â†’ í•´ì„ â†’ ì ìˆ ê°€ ìŠ¤íƒ€ì¼ ê²°ê³¼ë¬¼ ê¹Œì§€ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ì¡°ì •í•©ë‹ˆë‹¤.

### í•µì‹¬ ë©”ì„œë“œ

#### `async cast_divination(question, main_category, period) -> DivinationOutput`

ì ìˆ ì„ ìˆ˜í–‰í•˜ê³  ì™„ì „í•œ í•´ì„ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

**íŒŒë¼ë¯¸í„°:**
- `question` (str): ì‚¬ìš©ì ì§ˆë¬¸
- `main_category` (int): ëŒ€ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ ID (0-8, 9=ê¸°íƒ€)
- `period` (str): ì‹œê°„ êµ¬ë¶„ ("daily", "weekly", "monthly" ë“±)

**ë°˜í™˜ê°’:**
- `DivinationOutput`: ì™„ì „í•œ ì ìˆ  ê²°ê³¼ (ê´˜, íš¨, í•´ì„, í–‰ë™ ê°€ì´ë“œ ë“±)

**ì²˜ë¦¬ íë¦„ (v2.0 - AI í•´ì„ ê°€ì´ë“œë¼ì¸ ì ìš©):**

```
1. ì¹´í…Œê³ ë¦¬ ë§¤ì¹­
   â”œâ”€ category_matcher.match_question() í˜¸ì¶œ
   â””â”€ ì‚¬ìš©ì ì„ íƒ ë˜ëŠ” ìë™ ë¶„ë¥˜

2. ì ìˆ  ìˆ˜í–‰
   â”œâ”€ divination_service.uniform_384_divination() í˜¸ì¶œ
   â””â”€ DivinationResult íšë“ (ê´˜ë²ˆí˜¸, ë³€íš¨ ë“±)

3. ê´˜ ë°ì´í„° ì¡°íšŒ
   â”œâ”€ hexagram_repository.get_hexagram() í˜¸ì¶œ
   â””â”€ ë³¸ê´˜ + ì§€ê´˜ ë°ì´í„° ì¡°íšŒ

4. í•´ì„ ë°ì´í„° ì„ íƒ
   â”œâ”€ ReadingType ê¸°ë°˜ ë°ì´í„° ì„ íƒ
   â”‚  â”œâ”€ GUA_CI: ê´˜ì‚¬
   â”‚  â”œâ”€ YAO_CI: íš¨ì‚¬
   â”‚  â”œâ”€ BOTH_GUA_CI: ë³¸ê´˜+ì§€ê´˜
   â”‚  â””â”€ íŠ¹ìˆ˜: ìš©êµ¬, ìš©ìœ¡
   â””â”€ ìš´ì„¸, í‚¤ì›Œë“œ, í•´ì„ í…ìŠ¤íŠ¸ íšë“

5. [NEW v2.0] ì§ˆë¬¸ ë°©í–¥ ë¶„ì„
   â”œâ”€ analyze_question_direction() í˜¸ì¶œ
   â””â”€ ì§ˆë¬¸ì´ 'ì‹œì‘/ìœ ì§€/ë³€í™”/ì¢…ë£Œ' ì¤‘ ì–´ëŠ ê²ƒì¸ì§€ ë¶„ë¥˜

6. [NEW v2.0] íš¨ì‚¬ ë°©í–¥ ë¶„ì„
   â”œâ”€ get_yao_direction() í˜¸ì¶œ
   â””â”€ íš¨ì‚¬ê°€ 'ìƒìŠ¹/ì •ì²´/í•˜ê°•' ì¤‘ ì–´ëŠ ê²ƒì¸ì§€ ë¶„ì„

7. [NEW v2.0] ê²°í•© ë§¤íŠ¸ë¦­ìŠ¤ ì¡°íšŒ
   â”œâ”€ get_action_guidance() í˜¸ì¶œ
   â”‚  â””â”€ (íš¨ì‚¬ë°©í–¥, ì§ˆë¬¸ë°©í–¥) ì¡°í•©ìœ¼ë¡œ í–‰ë™ ê°€ì´ë“œ ì¡°íšŒ
   â””â”€ í–‰ë™ ì§€ì¹¨, ì ìˆ ê°€ ë¬¸ì¥, ìš´ì„¸ ì„±í–¥ íšë“

8. [NEW v2.0] 5ë‹¨ê³„ ì ìˆ ê°€ í•´ì„ ìƒì„±
   â”œâ”€ oracle_generator.generate() í˜¸ì¶œ
   â””â”€ ê´˜ëª…, íš¨ì‚¬, ì§ˆë¬¸ ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ì ìˆ ê°€ í•´ì„ ìƒì„±

9. LLM ì–´íˆ¬ ë³€í™˜
   â”œâ”€ llm_service.transform_tone() í˜¸ì¶œ
   â””â”€ ì›ë¬¸ì„ ì ìˆ ê°€ ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜

10. ê²°ê³¼ ì¡°í•©
    â””â”€ DivinationOutput ê°ì²´ ìƒì„± ë° ë°˜í™˜
```

---

## DivinationOutput (DTO)

ì ìˆ  ê²°ê³¼ë¥¼ ë‹´ëŠ” ë°ì´í„° ì „ì†¡ ê°ì²´ì…ë‹ˆë‹¤.

### í•„ë“œ êµ¬ì¡°

#### ê´˜ ì •ë³´
```python
hexagram: HexagramData                  # ë³¸ê´˜
transformed_hexagram: Optional[...] # ì§€ê´˜ (ë³€íš¨ ìˆì„ ë•Œ)
```

#### íš¨ ì •ë³´
```python
yao: Optional[YaoData]              # íš¨ ë°ì´í„° (íš¨ì‚¬ í•´ì„ ì‹œ)
yao_position: Optional[int]         # íš¨ì˜ ìœ„ì¹˜ (1-6)
```

#### í•´ì„ ì •ë³´
```python
reading_type: str                   # í•´ì„ ë°©ì‹ (GUA_CI, YAO_CI, BOTH_GUA_CI)
reading_description: str            # í•´ì„ ë°©ì‹ ì„¤ëª…
use_transformed: bool               # ì§€ê´˜ ì‚¬ìš© ì—¬ë¶€
```

#### ê´˜ì‚¬ ì •ë³´
```python
gua_ci: Optional[str]               # ë³¸ê´˜ ê´˜ì‚¬
transformed_gua_ci: Optional[str]   # ì§€ê´˜ ê´˜ì‚¬
```

#### í•´ì„ ê²°ê³¼
```python
interpretation: str                 # [ìµœì¢…] LLM ì–´íˆ¬ ë³€í™˜ëœ í•´ì„
fortune_score: int                  # ìš´ì„¸ ì ìˆ˜ (0-100)
fortune_category: str               # ìš´ì„¸ ë“±ê¸‰ (ëŒ€ê¸¸/ê¸¸/í‰/í‰/ëŒ€í‰)
keywords: List[str]                 # í•µì‹¬ í‚¤ì›Œë“œ
```

#### í–‰ë™ ê°€ì´ë“œ
```python
action_guide: str                   # v2.0: ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ í–‰ë™ ì§€ì¹¨
caution: str                        # v2.0: ì£¼ì˜ì‚¬í•­
```

#### ì¹´í…Œê³ ë¦¬
```python
matched_category: str               # ë§¤ì¹­ëœ ì¹´í…Œê³ ë¦¬ (ì˜ˆ: "ì‚¬ë‘/ì—°ì• ")
changing_lines: List[int]           # ë³€í•˜ëŠ” íš¨ì˜ ìœ„ì¹˜ ëª©ë¡
```

#### v2.0 ì‹ ê·œ í•„ë“œ (AI í•´ì„ ê°€ì´ë“œë¼ì¸)

**íš¨ì‚¬ ë°©í–¥:**
```python
yao_direction: Optional[str]        # íš¨ì‚¬ì˜ ë°©í–¥ì„± (ìƒìŠ¹/ì •ì²´/í•˜ê°•)
yao_direction_code: Optional[str]   # ì˜ë¬¸ ì½”ë“œ (ASCENDING/STAGNANT/DESCENDING)
```

**ì§ˆë¬¸ ë°©í–¥:**
```python
question_direction: Optional[str]   # ì§ˆë¬¸ì˜ ì˜ë„ (ì‹œì‘/ìœ ì§€/ë³€í™”/ì¢…ë£Œ)
question_direction_code: Optional[str]  # ì˜ë¬¸ ì½”ë“œ (START/MAINTAIN/CHANGE/END)
question_confidence: float          # ì§ˆë¬¸ ë¶„ì„ ì‹ ë¢°ë„ (0.0~1.0)
```

**ë§¤íŠ¸ë¦­ìŠ¤ ê²°í•© ê²°ê³¼:**
```python
matrix_action: Optional[str]        # ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ í–‰ë™ (ë‚˜ì•„ê°€ë¼/ê¸°ë‹¤ë¦¬ë¼ ë“±)
matrix_oracle_phrase: Optional[str] # ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ì ìˆ ê°€ ë¬¸ì¥
matrix_compatibility: float         # ì§ˆë¬¸-íš¨ì‚¬ ì¼ì¹˜ë„ (0.0~1.0)
matrix_fortune_tendency: Optional[str]  # ìš´ì„¸ ì„±í–¥ (ëŒ€ê¸¸/ê¸¸/ì¤‘ê¸¸/ì¤‘í‰/ì†Œí‰/í‰/ëŒ€í‰)
```

**ì ìˆ ê°€ í•´ì„:**
```python
oracle_interpretation: Optional[str] # 5ë‹¨ê³„ ì ìˆ ê°€ ìŠ¤íƒ€ì¼ ì „ì²´ í•´ì„
```

---

## ì£¼ìš” ë‚´ë¶€ ë©”ì„œë“œ

### `_get_interpretation_data(result, hexagram, transformed_hexagram) -> dict`

ì ìˆ  ê²°ê³¼ì˜ ìœ í˜•ì— ë”°ë¼ ì ì ˆí•œ ë°ì´í„°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

**íŒŒë¼ë¯¸í„°:**
- `result`: ì ìˆ  ìˆ˜í–‰ ê²°ê³¼ (DivinationResult)
- `hexagram`: ë³¸ê´˜ ë°ì´í„°
- `transformed_hexagram`: ì§€ê´˜ ë°ì´í„° (ì„ íƒ)

**ë°˜í™˜ê°’:**
```python
{
    "source": str,              # í•´ì„ì˜ ì›ë¬¸ (ê´˜ì‚¬ ë˜ëŠ” íš¨ì‚¬)
    "fortune_score": int,       # ìš´ì„¸ ì ìˆ˜
    "fortune_category": str,    # ìš´ì„¸ ë“±ê¸‰
    "keywords": List[str],      # í•µì‹¬ í‚¤ì›Œë“œ
    "yao": Optional[YaoData],   # íš¨ ë°ì´í„°
    "gua_ci": Optional[str],    # ë³¸ê´˜ ê´˜ì‚¬
    "transformed_gua_ci": Optional[str]  # ì§€ê´˜ ê´˜ì‚¬
}
```

**ë¡œì§:**

| ReadingType | ì²˜ë¦¬ ë‚´ìš© | íŠ¹ì§• |
|---|---|---|
| **GUA_CI** | ê´˜ì‚¬ë§Œ ì‚¬ìš© | ë³€íš¨ 0ê°œ ë˜ëŠ” 6ê°œ (ì¼ë°˜ì ì¸ ê²½ìš°) |
| **YAO_CI** | íŠ¹ì • íš¨ì‚¬ë§Œ ì‚¬ìš© | ë³€íš¨ 1ê°œ (1-5ë²ˆ) |
| **BOTH_GUA_CI** | ë³¸ê´˜+ì§€ê´˜ ê´˜ì‚¬ | ë³€íš¨ 3ê°œ (í•µì‹¬ ë³€í™”) |
| **YONG_JIU** | ìš©êµ¬ íŠ¹ìˆ˜ í•´ì„ | ê±´ê´˜ 6ë³€íš¨ |
| **YONG_LIU** | ìš©ìœ¡ íŠ¹ìˆ˜ í•´ì„ | ê³¤ê´˜ 6ë³€íš¨ |

---

### `_build_category_name(main_id, sub_id) -> str`

ì¹´í…Œê³ ë¦¬ IDë¥¼ ì½ê¸° ì‰¬ìš´ ì´ë¦„ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

**ì˜ˆì‹œ:**
```python
_build_category_name(1, 2)  # â†’ "ì‚¬ë‘/ì§ì‚¬ë‘"
_build_category_name(3, None)  # â†’ "ëˆ"
```

---

### `_get_action_guide()` ë° `_get_caution()` (Fallback)

ìš´ì„¸ ë“±ê¸‰ì— ë”°ë¥¸ ê¸°ë³¸ í–‰ë™ ê°€ì´ë“œì™€ ì£¼ì˜ì‚¬í•­ì„ ì œê³µí•©ë‹ˆë‹¤.

**ì£¼ì˜:** v2.0ì—ì„œëŠ” ì‹¤ì œ ê°’ì´ `get_action_guidance()` ë§¤íŠ¸ë¦­ìŠ¤ì—ì„œ ë‚˜ì˜¤ë¯€ë¡œ, ì´ ë©”ì„œë“œë“¤ì€ fallbackìš©ìœ¼ë¡œë§Œ ìœ ì§€ë©ë‹ˆë‹¤.

---

## ë°ì´í„° íë¦„ (ìƒì„¸)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ìš©ì ìš”ì²­                                                   â”‚
â”‚ (ì§ˆë¬¸, ì¹´í…Œê³ ë¦¬, ê¸°ê°„)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ ì¹´í…Œê³ ë¦¬ ë§¤ì¹­ (category_matcher)                           â”‚
â”‚    - ì§ˆë¬¸ í…ìŠ¤íŠ¸ ë¶„ì„                                         â”‚
â”‚    - ëŒ€ë¶„ë¥˜ + ì†Œë¶„ë¥˜ ìë™ ë¶„ë¥˜                               â”‚
â”‚    - ì‚¬ìš©ì ì„ íƒ ìš°ì„                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ ì ìˆ  ìˆ˜í–‰ (divination_service)                            â”‚
â”‚    - uniform_384_divination() ì•Œê³ ë¦¬ì¦˜                        â”‚
â”‚    - ê²°ê³¼: ê´˜ë²ˆí˜¸, ë³€íš¨, í•´ì„ë°©ì‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ ê´˜ ë°ì´í„° ì¡°íšŒ (hexagram_repository)                      â”‚
â”‚    - ë³¸ê´˜ HexagramData ì¡°íšŒ                                  â”‚
â”‚    - ì§€ê´˜ HexagramData ì¡°íšŒ (ìˆìœ¼ë©´)                          â”‚
â”‚    - ê´˜ëª…, ê´˜ì‚¬, ì†ì„± í¬í•¨                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ í•´ì„ ë°ì´í„° ì„ íƒ (_get_interpretation_data)              â”‚
â”‚    - ReadingType ê¸°ë°˜ ë¶„ê¸°                                    â”‚
â”‚    - íš¨ì‚¬ ë˜ëŠ” ê´˜ì‚¬ ë˜ëŠ” ë‘˜ ë‹¤ ì„ íƒ                            â”‚
â”‚    - ìš´ì„¸, í‚¤ì›Œë“œ íšë“                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ ì§ˆë¬¸ ë°©í–¥ ë¶„ì„ (question_direction)                       â”‚
â”‚    - ë¶„ë¥˜: START/MAINTAIN/CHANGE/END                          â”‚
â”‚    - ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ íš¨ì‚¬ ë°©í–¥ ë¶„ì„ (yao_direction)                            â”‚
â”‚    - ë¶„ë¥˜: ASCENDING/STAGNANT/DESCENDING                     â”‚
â”‚    - ëŒ€ìƒ ê´˜ë²ˆí˜¸ + íš¨ìœ„ì¹˜ ê¸°ë°˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7ï¸âƒ£ ê²°í•© ë§¤íŠ¸ë¦­ìŠ¤ ì¡°íšŒ (interpretation_matrix)                 â”‚
â”‚    - (íš¨ì‚¬ë°©í–¥, ì§ˆë¬¸ë°©í–¥) â†’ í–‰ë™ ê°€ì´ë“œ                        â”‚
â”‚    - 12ê°€ì§€ í–‰ë™: ë‚˜ì•„ê°€ë¼, ê¸°ë‹¤ë¦¬ë¼, ë³€í™”í•˜ë¼ ë“±            â”‚
â”‚    - ìš´ì„¸ ì„±í–¥, ì¼ì¹˜ë„ ê³„ì‚°                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8ï¸âƒ£ 5ë‹¨ê³„ ì ìˆ ê°€ í•´ì„ (oracle_generator)                      â”‚
â”‚    - Step 1: ê´˜/íš¨ ìƒí™© ì„¤ëª…                                  â”‚
â”‚    - Step 2: ë³€í™” ë°©í–¥ í•´ì„                                   â”‚
â”‚    - Step 3: ì§ˆë¬¸ ì—°ê³„ ë¶„ì„                                   â”‚
â”‚    - Step 4: í–‰ë™ ì§€ì¹¨ ì œì‹œ                                   â”‚
â”‚    - Step 5: ì£¼ì˜ì‚¬í•­ ê°•ì¡°                                    â”‚
â”‚    - ê²°ê³¼: 5ë‹¨ê³„ ì ìˆ ê°€ í…ìŠ¤íŠ¸                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9ï¸âƒ£ LLM ì–´íˆ¬ ë³€í™˜ (llm_service)                               â”‚
â”‚    - ì…ë ¥: ì›ë¬¸ + ë§¤íŠ¸ë¦­ìŠ¤ ê°€ì´ë“œ                             â”‚
â”‚    - ì²˜ë¦¬: GPT ê¸°ë°˜ ì–´íˆ¬ ë³€í™˜                                â”‚
â”‚    - ìŠ¤íƒ€ì¼: oracle (ì ìˆ ê°€ ìŠ¤íƒ€ì¼)                           â”‚
â”‚    - ê²°ê³¼: ìµœì¢… í•´ì„ í…ìŠ¤íŠ¸                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Ÿ ê²°ê³¼ ì¡°í•© (DivinationOutput)                               â”‚
â”‚    - v1.0 í•„ë“œ: ê´˜, íš¨, ê´˜ì‚¬, í•´ì„                            â”‚
â”‚    - v2.0 í•„ë“œ: ë§¤íŠ¸ë¦­ìŠ¤ ì •ë³´, ë°©í–¥ ë¶„ì„, ì ìˆ ê°€ í•´ì„        â”‚
â”‚    - ìµœì¢… JSON ì‘ë‹µ ìƒì„±                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        ğŸ“¤ API ì‘ë‹µ ë°˜í™˜
```

---

## ì˜ì¡´ì„± ë§µ

```
DivinationUseCase
â”œâ”€â”€ Repository
â”‚   â”œâ”€ hexagram_repository (ê´˜ ë°ì´í„°)
â”‚   â””â”€ yao_repository (íš¨ ë°ì´í„°)
â”‚
â”œâ”€â”€ Service
â”‚   â”œâ”€ divination_service (ì ìˆ  ì•Œê³ ë¦¬ì¦˜)
â”‚   â”œâ”€ category_matcher (ì§ˆë¬¸ ë¶„ë¥˜)
â”‚   â”œâ”€ llm_service (LLM ì–´íˆ¬ ë³€í™˜)
â”‚   â””â”€ oracle_generator (5ë‹¨ê³„ ì ìˆ ê°€ í•´ì„)
â”‚
â””â”€â”€ Data/Module
    â”œâ”€ yao_direction (íš¨ì‚¬ ë°©í–¥ ë¶„ì„)
    â”œâ”€ question_direction (ì§ˆë¬¸ ë°©í–¥ ë¶„ì„)
    â”œâ”€ interpretation_matrix (ê²°í•© ë§¤íŠ¸ë¦­ìŠ¤)
    â””â”€ category_seed (ì¹´í…Œê³ ë¦¬ ì •ë³´)
```

---

## ì‚¬ìš© ì˜ˆì‹œ

### ê¸°ë³¸ ì ìˆ 

```python
from app.usecases import divination_usecase

# ì ìˆ  ìˆ˜í–‰
result = await divination_usecase.cast_divination(
    question="ì•ìœ¼ë¡œì˜ ì§„ë¡œê°€ ì–´ë–»ê²Œ ë ê¹Œìš”?",
    main_category=4,  # "ì§ì—…/ì§„ë¡œ"
    period="yearly"
)

# ê²°ê³¼ ì ‘ê·¼
print(result.hexagram.name_korean)          # "å¤ å¤"
print(result.interpretation)                # "[ìµœì¢…] ì ìˆ ê°€ ìŠ¤íƒ€ì¼ í•´ì„"
print(result.matrix_action)                 # "ë‚˜ì•„ê°€ë¼"
print(result.question_direction)            # "ì‹œì‘"
print(result.yao_direction)                 # "ìƒìŠ¹"
```

### v2.0 ì‹ ê·œ í•„ë“œ í™œìš©

```python
result = await divination_usecase.cast_divination(
    question="ì´ ì‚¬ë‘ì´ ì´ë£¨ì–´ì§ˆê¹Œìš”?",
    main_category=1,  # "ì‚¬ë‘/ì—°ì• "
    period="monthly"
)

# v2.0 ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ê°€ì´ë“œ
print(f"íš¨ì‚¬ ë°©í–¥: {result.yao_direction}")           # ASCENDING
print(f"ì§ˆë¬¸ ë°©í–¥: {result.question_direction}")      # MAINTAIN
print(f"ì¶”ì²œ í–‰ë™: {result.matrix_action}")           # "ê¸°ë‹¤ë¦¬ë¼"
print(f"ìš´ì„¸ ì„±í–¥: {result.matrix_fortune_tendency}") # "ê¸¸"
print(f"ì¼ì¹˜ë„: {result.matrix_compatibility:.2%}")   # 78.50%

# ì ìˆ ê°€ í•´ì„ (5ë‹¨ê³„)
print(result.oracle_interpretation)
```

---

## í™•ì¥ í¬ì¸íŠ¸

UseCaseëŠ” ë‹¤ìŒê³¼ ê°™ì´ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤:

### 1. ìƒˆë¡œìš´ ì ìˆ  ë°©ì‹ ì¶”ê°€

```python
async def cast_divination_advanced(
    self,
    question: str,
    method: str = "default",  # "default", "advanced", "custom"
    ...
) -> DivinationOutput:
    # ìƒˆë¡œìš´ divination_service ë©”ì„œë“œ í˜¸ì¶œ
    # ê²°ê³¼ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    pass
```

### 2. ë‹¤ì¤‘ ì§ˆë¬¸ ì ìˆ 

```python
async def cast_multiple_divination(
    self,
    questions: List[str],
    main_category: int,
    ...
) -> List[DivinationOutput]:
    # ì—¬ëŸ¬ ì§ˆë¬¸ì„ ë³‘ë ¬ ì²˜ë¦¬
    # ê²°ê³¼ ì¡°í•©
    pass
```

### 3. ì¹´ìŠ¤í…€ í•´ì„ ê°€ì´ë“œ

```python
async def cast_divination_with_custom_guide(
    self,
    question: str,
    custom_guidance_function: Callable,
    ...
) -> DivinationOutput:
    # ì‚¬ìš©ì ì •ì˜ ê°€ì´ë“œ í•¨ìˆ˜ ì ìš©
    pass
```

---

## í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```python
import pytest
from app.usecases import divination_usecase

@pytest.mark.asyncio
async def test_cast_divination():
    result = await divination_usecase.cast_divination(
        question="í…ŒìŠ¤íŠ¸ ì§ˆë¬¸",
        main_category=0,
        period="daily"
    )

    assert result.hexagram is not None
    assert result.interpretation != ""
    assert 0 <= result.fortune_score <= 100
    assert result.question_confidence >= 0
    assert result.matrix_compatibility >= 0
```

### í†µí•© í…ŒìŠ¤íŠ¸

```python
@pytest.mark.asyncio
async def test_divination_full_pipeline():
    # ê° ë‹¨ê³„ê°€ ì˜¬ë°”ë¥´ê²Œ ì—°ê²°ë˜ëŠ”ì§€ í™•ì¸
    result = await divination_usecase.cast_divination(...)

    # v2.0 í•„ë“œ í™•ì¸
    assert result.yao_direction_code in ["ASCENDING", "STAGNANT", "DESCENDING"]
    assert result.question_direction_code in ["START", "MAINTAIN", "CHANGE", "END"]
    assert result.oracle_interpretation is not None
```

---

## ë²„ì „ íˆìŠ¤í† ë¦¬

### v1.0
- ê¸°ë³¸ ì ìˆ  ë° í•´ì„
- Repository + Service ì¡°í•©
- ìš´ì„¸, í‚¤ì›Œë“œ, í–‰ë™ ê°€ì´ë“œ

### v2.0 (AI í•´ì„ ê°€ì´ë“œë¼ì¸)
- íš¨ì‚¬ ë°©í–¥ ë¶„ì„ (ASCENDING/STAGNANT/DESCENDING)
- ì§ˆë¬¸ ë°©í–¥ ë¶„ì„ (START/MAINTAIN/CHANGE/END)
- ê²°í•© ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ í–‰ë™ ì§€ì¹¨ (12ê°€ì§€ íŒ¨í„´)
- 5ë‹¨ê³„ ì ìˆ ê°€ í•´ì„ ìƒì„±
- LLM ì–´íˆ¬ ë³€í™˜ (oracle ìŠ¤íƒ€ì¼)
- ì§ˆë¬¸-íš¨ì‚¬ ì¼ì¹˜ë„ ê³„ì‚°
- ìš´ì„¸ ì„±í–¥ ë¶„ë¥˜ (7ë‹¨ê³„)

---

## ì°¸ê³ 

- ì „ì²´ ë°ì´í„° ì¸ë±ìŠ¤: [docs/DATA_INDEX.md](../../docs/DATA_INDEX.md)
- Repository íŒ¨í„´: [repositories/README.md](../repositories/README.md)
- Service íŒ¨í„´: [services/README.md](../services/README.md)
