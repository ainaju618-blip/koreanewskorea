"""
일간운세 해석문 자동 생성 스크립트

384효 × 3변형 = 1,152개 해석문 생성
기존 yao_complete.py의 데이터를 기반으로 생성

작성 원칙:
1. 대제목: 15-25자, 오늘의 핵심 메시지
2. 본문: 50-70자, 2문장 (상황 + 행동 지침)
3. 괘 이름 절대 금지
4. 철학적/종교적 표현 금지
5. 구체적 행동 지침 필수

변형 테마:
v1: 일/직장/성취 중심
v2: 관계/소통 중심
v3: 내면/선택/마음 중심
"""

import sys
import os
import random

# 프로젝트 루트 추가
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from app.data.yao_complete import YAO_DATA


# =============================================================================
# 템플릿 정의
# =============================================================================

# 대제목 템플릿 (fortune_category별) - 15-25자 범위
HEADLINE_TEMPLATES = {
    "대길": {
        "work": [
            "모든 일이 술술 풀리는 최고의 날",
            "원하던 성과를 거두는 절호의 기회",
            "노력한 만큼 보상받는 행운의 하루",
            "자신감을 갖고 크게 움직여도 되는 날",
            "최고의 결실을 맺을 수 있는 하루",
            "오랫동안 준비한 것이 빛나는 때",
            "크게 도약하여 새 세상을 여는 날",
            "모든 조건이 갖춰진 황금 같은 하루",
        ],
        "relation": [
            "좋은 인연이 찾아와 기쁨을 주는 날",
            "귀인의 도움으로 큰일을 이루는 하루",
            "함께하면 더 큰 성공을 얻는 때",
            "소통이 원활하여 마음이 통하는 날",
            "협력과 화합이 빛나는 최고의 하루",
            "인정받고 신뢰를 얻는 특별한 때",
            "좋은 사람들이 모여드는 행운의 날",
            "관계가 깊어져 함께 성장하는 하루",
        ],
        "inner": [
            "마음먹은 대로 이루어지는 기적의 날",
            "직감을 믿고 결단해도 좋은 하루",
            "확신을 갖고 당당히 나아갈 때",
            "내면의 힘이 빛을 발하는 하루",
            "선택한 길이 정답임을 확인하는 날",
            "마음이 평온하고 기쁨이 넘치는 때",
            "원하는 방향으로 순조롭게 흐르는 날",
            "결단력이 좋은 결과를 이끌어내는 하루",
        ],
    },
    "길": {
        "work": [
            "계획대로 순조롭게 진행되는 하루",
            "작은 성과들이 쌓여 발전하는 날",
            "한 걸음 앞으로 나아갈 수 있는 때",
            "노력이 인정받아 보람을 느끼는 하루",
            "좋은 기회를 잡을 수 있는 행운의 날",
            "긍정적인 결과가 예상되는 하루",
            "실력을 마음껏 발휘할 수 있는 때",
            "성실함이 빛을 발하는 보람찬 날",
        ],
        "relation": [
            "도움을 주고받으며 함께 성장하는 날",
            "소통이 원활하여 마음이 통하는 하루",
            "좋은 제안이 들어오는 행운의 때",
            "새로운 인연을 맺기 좋은 날",
            "협력하면 더 좋은 결과를 얻는 하루",
            "주변의 지지와 격려를 받는 때",
            "서로 마음이 통하여 기쁜 날",
            "관계가 깊어지고 신뢰가 쌓이는 하루",
        ],
        "inner": [
            "자신감을 가져도 좋은 밝은 하루",
            "믿음대로 움직이면 좋은 결과의 날",
            "긍정적인 마음이 길을 여는 때",
            "선택에 확신을 갖고 나아갈 하루",
            "편안한 마음으로 임하면 되는 날",
            "흐름에 몸을 맡겨도 괜찮은 때",
            "마음가는 대로 해도 잘 되는 하루",
            "내면의 목소리를 따르면 좋은 날",
        ],
    },
    "평": {
        "work": [
            "현상 유지에 집중하는 것이 최선인 날",
            "급하게 서두르지 않아야 하는 하루",
            "차분하게 기존 일을 정리하는 때",
            "무리하지 않고 안정을 유지할 날",
            "인내하며 때를 기다려야 하는 하루",
            "조용히 내일을 준비하는 것이 좋은 때",
            "변화보다 안정을 택해야 하는 날",
            "기다림의 지혜가 필요한 하루",
        ],
        "relation": [
            "무난하게 관계를 유지하는 것이 상책",
            "굳이 먼저 나서지 않아도 되는 날",
            "조용히 상황을 관망해야 하는 하루",
            "불필요한 만남과 약속을 줄여야 할 때",
            "평소처럼 관계를 유지하면 좋은 날",
            "급하게 관계에 변화를 주지 말아야 할 때",
            "담담하게 거리감을 유지해야 하는 날",
            "한 발 물러서서 지켜보는 것이 현명한 하루",
        ],
        "inner": [
            "침착하게 상황을 판단해야 하는 때",
            "결정을 조금 미뤄도 괜찮은 날",
            "서두르지 않는 것이 지혜로운 하루",
            "마음을 가라앉히고 안정을 찾을 때",
            "욕심을 내려놓고 현재에 집중할 날",
            "평온함을 유지하는 것이 중요한 하루",
            "중심을 잡고 흔들리지 말아야 할 때",
            "내면을 돌아보며 성찰하는 시간",
        ],
    },
    "흉": {
        "work": [
            "모든 일에 조심스럽게 움직여야 할 날",
            "새로운 시작이나 변화를 피해야 할 때",
            "큰 결정은 미루는 것이 현명한 하루",
            "손실을 최소화하는 데 집중해야 할 날",
            "위험 신호를 무시하면 안 되는 때",
            "한 발 물러서서 상황을 살펴야 할 하루",
            "무리하면 반드시 탈이 나는 날",
            "안전을 최우선으로 생각해야 할 때",
        ],
        "relation": [
            "말과 행동을 조심해야 하는 하루",
            "다툼과 갈등을 피해야 하는 날",
            "사람을 가려서 만나야 하는 때",
            "오해가 생기기 쉬우니 조심할 하루",
            "거리를 두고 지켜보는 것이 좋은 날",
            "불필요한 충돌을 피해야 하는 때",
            "속마음을 드러내지 않아야 할 하루",
            "조용히 혼자 시간을 갖는 것이 나은 날",
        ],
        "inner": [
            "감정을 다스리고 냉정해야 하는 때",
            "충동적인 결정을 피해야 하는 하루",
            "불안해도 참고 기다려야 하는 날",
            "욕심이 화를 부르니 조심해야 할 때",
            "겸손하게 자세를 낮춰야 하는 하루",
            "집착을 내려놓아야 평화로운 날",
            "마음을 비우고 쉬어야 하는 때",
            "멈추고 돌아봐야 하는 하루",
        ],
    },
    "대흉": {
        "work": [
            "모든 일에 최대한 조심해야 할 하루",
            "어떤 일도 시작하지 않는 것이 최선",
            "절대 무리하거나 욕심내면 안 되는 날",
            "손대지 않고 가만히 있는 것이 정답",
            "위험을 감지하고 피해가야 할 때",
            "후퇴가 곧 전진이 되는 날",
            "새로운 시작은 절대 금물인 하루",
            "완전히 멈추고 상황을 관망해야 할 때",
        ],
        "relation": [
            "사람을 멀리하고 조용히 지내야 할 날",
            "어떤 약속이나 계약도 피해야 할 때",
            "혼자 있는 것이 최선인 하루",
            "모든 다툼과 논쟁에서 물러나야 할 날",
            "입을 닫고 침묵하는 것이 지혜인 때",
            "관계에서 완전히 한 발 빠져야 할 하루",
            "아무도 믿지 않는 것이 안전한 날",
            "연락과 만남을 끊는 것도 방법인 때",
        ],
        "inner": [
            "모든 욕심과 기대를 버려야 할 때",
            "완전히 포기하고 내려놓아야 할 날",
            "마음을 완전히 비우고 쉬어야 할 하루",
            "집착이 파멸을 부르니 놓아야 할 때",
            "자만심을 완전히 꺾어야 하는 날",
            "무(無)의 상태로 돌아가야 할 하루",
            "어떤 선택도 결정도 하지 말아야 할 때",
            "오직 인내와 기다림만이 답인 날",
        ],
    },
}

# 본문 첫 문장 템플릿 (상황 설명) - 28-38자 범위로 확장
BODY_FIRST_TEMPLATES = {
    "대길": [
        "오랫동안 준비했던 일을 이제 본격적으로 시작해도 좋은 때다.",
        "오늘 무엇을 시작하든 큰 성공으로 이어질 것이니 자신감을 가져라.",
        "모든 조건이 완벽하게 갖춰졌으니 더 이상 주저할 이유가 없다.",
        "지금이야말로 움직여서 원하는 것을 얻을 최적의 타이밍이다.",
        "더 이상 망설이거나 주저할 이유가 전혀 없는 최고의 상황이다.",
        "그동안 열심히 준비한 것을 마음껏 세상에 펼쳐도 좋은 때다.",
        "노력한 만큼 정확하게 보상받는 행복한 시간이 찾아왔다.",
        "하늘이 돕는 듯 맡은 일들이 모두 순조롭게 흘러가고 있다.",
    ],
    "길": [
        "맡은 일들이 예상했던 것보다 훨씬 순조롭게 진행되고 있다.",
        "주변에서 긍정적이고 좋은 기운이 느껴지는 하루가 될 것이다.",
        "작은 성과들이 차곡차곡 쌓여 나중에 큰 결과로 이어질 것이다.",
        "좋은 조짐들이 여기저기서 보이니 자신감을 가지고 행동해도 좋다.",
        "한 걸음 더 앞으로 나아가서 목표에 다가갈 수 있는 때가 왔다.",
        "오래 기다리던 기회가 조금씩 눈앞으로 다가오고 있는 것 같다.",
        "상황이 점점 좋은 방향으로 흘러가고 있으니 희망을 잃지 마라.",
        "그동안 꾸준히 해온 노력들이 드디어 결실을 맺기 시작한다.",
    ],
    "평": [
        "지금은 큰 변화를 추구하기보다 현재 상태를 유지하는 것이 낫다.",
        "급하게 서두르거나 무리하면 오히려 일을 그르칠 수 있으니 조심하라.",
        "조급해하지 말고 상황이 충분히 무르익기를 차분하게 기다려라.",
        "아직 움직일 때가 오지 않았으니 조금 더 인내심을 가지고 기다려라.",
        "무리하게 밀어붙이거나 욕심을 내면 오히려 탈이 날 수 있다.",
        "천천히 한 걸음씩 신중하게 가는 것이 지금은 가장 현명한 선택이다.",
        "특별한 일을 새로 벌이기보다는 기존에 하던 일에 집중하는 게 좋다.",
        "평온하게 오늘 하루를 보내면서 내일의 기회를 준비하는 때다.",
    ],
    "흉": [
        "조심하지 않으면 예상치 못한 곳에서 손해를 볼 수 있으니 경계하라.",
        "주변에 위험 신호들이 곳곳에 있으니 절대로 경계를 늦추지 마라.",
        "무리하게 밀어붙이거나 욕심을 부리면 큰 화를 자초할 수 있다.",
        "지금 가고 있는 방향이 정말 맞는 것인지 한번 더 다시 점검하라.",
        "여기서 멈추지 않고 계속 가면 나중에 반드시 후회하게 될 것이다.",
        "지나친 욕심을 부리면 지금 가지고 있는 것마저 잃을 수 있다.",
        "경계심을 조금이라도 늦추는 순간 예상치 못한 문제가 발생할 것이다.",
        "상황이 녹록지 않으니 오늘 하루는 최대한 조심해서 움직여라.",
    ],
    "대흉": [
        "지금은 모든 것을 완전히 멈추고 상황을 관망하는 것이 최선이다.",
        "어떤 새로운 시도도 하지 않고 가만히 있는 것이 지금은 최선이다.",
        "완전히 물러서서 이 어려운 때가 지나가기를 기다리는 것이 현명하다.",
        "움직이면 움직일수록 상황이 더 나빠질 것이니 멈추는 것이 답이다.",
        "손을 대면 댈수록 손해만 눈덩이처럼 커지니 건드리지 마라.",
        "지금은 어떤 선택을 해도 위험이 따르는 때니 결정을 미뤄라.",
        "침묵하고 인내하면서 기다리는 것만이 지금은 유일한 해답이다.",
        "최악의 상황까지 염두에 두고 대비하면서 마음을 단단히 잡아라.",
    ],
}

# 본문 두 번째 문장 템플릿 (행동 지침) - 25-35자 범위
BODY_SECOND_TEMPLATES = {
    "대길": {
        "work": [
            "자신감을 갖고 크게 움직이면 반드시 성공한다.",
            "적극적으로 제안하고 요청하면 원하는 것을 얻는다.",
            "큰 그림을 그리고 과감하게 실행에 옮겨라.",
            "주저하지 말고 밀어붙이면 좋은 결과가 따라온다.",
            "눈앞의 기회를 놓치지 말고 확실하게 잡아라.",
            "최선을 다해 밀어붙이면 원하는 목표에 도달한다.",
            "목표를 향해 거침없이 전진하면 성취를 이룬다.",
            "과감하게 결단을 내리면 새로운 길이 열린다.",
        ],
        "relation": [
            "마음에 드는 사람에게 적극적으로 다가가라.",
            "도움을 요청하면 기꺼이 도와줄 사람이 있다.",
            "함께할 협력자를 구하면 더 큰 성과를 낸다.",
            "좋은 인연을 소중히 여기면 복이 따라온다.",
            "마음을 열고 진심으로 소통하면 관계가 깊어진다.",
            "진심을 표현하면 상대방도 마음을 연다.",
            "관계에 시간과 정성을 투자하면 보답을 받는다.",
            "함께하면 혼자보다 더 크게 이룰 수 있다.",
        ],
        "inner": [
            "확신을 갖고 선택하면 후회 없는 결과가 온다.",
            "직감을 믿고 행동해도 좋은 결과를 얻는다.",
            "마음 가는 대로 행동하면 길이 열릴 것이다.",
            "두려움을 버리고 나아가면 원하는 것을 얻는다.",
            "스스로를 믿고 당당하게 나아가면 성공한다.",
            "긍정적으로 생각하면 좋은 일이 찾아온다.",
            "원하는 것을 분명히 하면 우주가 도와준다.",
            "내면의 힘을 믿고 발휘하면 모든 것이 풀린다.",
        ],
    },
    "길": {
        "work": [
            "세운 계획대로 차분하게 진행하면 잘 된다.",
            "꾸준히 노력을 이어가면 원하는 결과를 얻는다.",
            "한 걸음씩 나아가면 목표에 도달할 수 있다.",
            "성실함을 유지하면 주변에서 인정받게 된다.",
            "기회가 왔을 때 잘 살펴서 놓치지 마라.",
            "작은 성과에도 감사하면 더 큰 복이 온다.",
            "흐름을 타고 전진하면 좋은 결과가 기다린다.",
            "열심히 하면 반드시 결과가 따라오게 된다.",
        ],
        "relation": [
            "주변의 조언에 귀 기울이면 좋은 길이 보인다.",
            "협력하면 혼자보다 더 좋은 결과를 얻는다.",
            "소통을 게을리하지 않으면 관계가 좋아진다.",
            "인연을 소중히 여기면 오래도록 함께할 수 있다.",
            "도움을 주고받으면 서로에게 힘이 된다.",
            "좋은 관계를 유지하면 언젠가 큰 도움이 된다.",
            "진심을 담아 대화하면 마음이 통하게 된다.",
            "함께하는 즐거움을 느끼며 하루를 보내라.",
        ],
        "inner": [
            "긍정적인 마음을 유지하면 좋은 일이 생긴다.",
            "흐름에 몸을 맡기면 자연스럽게 길이 열린다.",
            "자신을 믿고 나아가면 원하는 곳에 도달한다.",
            "마음의 여유를 가지면 더 멀리 볼 수 있다.",
            "좋은 방향으로 가고 있으니 그대로 나아가라.",
            "스스로를 격려하면 어려움도 이겨낼 수 있다.",
            "평온한 마음을 유지하면 현명한 판단이 가능하다.",
            "내면의 안정을 찾으면 모든 것이 편안해진다.",
        ],
    },
    "평": {
        "work": [
            "오늘은 기존 일을 다지는 데 집중하는 것이 좋다.",
            "새로운 시도는 내일로 미루고 현재에 충실하라.",
            "무리하지 말고 적당한 선에서 마무리하라.",
            "안정적으로 운영하면서 때가 오기를 기다려라.",
            "변화를 주지 않고 현상 유지하는 것이 현명하다.",
            "현재 상태를 유지하면서 내일의 기회를 노려라.",
            "기반을 다지는 데 집중하면 나중에 크게 이룬다.",
            "조용히 준비하는 시간이라 생각하고 정진하라.",
        ],
        "relation": [
            "불필요한 만남은 피하고 중요한 관계에 집중하라.",
            "조용히 지내면서 상황이 변하기를 기다려라.",
            "평소대로 관계를 유지하며 특별한 일을 만들지 마라.",
            "나서지 말고 지켜보면서 때가 오기를 기다려라.",
            "말을 아끼는 것이 현명하니 불필요한 말을 줄여라.",
            "적당한 거리를 유지하면서 관계를 지켜나가라.",
            "새로운 인연은 나중에 맺어도 충분히 좋다.",
            "관계에 변화를 주지 않고 평온하게 유지하라.",
        ],
        "inner": [
            "마음을 가라앉히고 기다리면 답이 보인다.",
            "욕심을 내려놓으면 마음이 편안해진다.",
            "결정은 나중에 해도 되니 서두르지 마라.",
            "침착함을 유지하면 좋은 판단을 할 수 있다.",
            "중심을 잡고 흔들리지 않으면 버틸 수 있다.",
            "평온을 유지하는 것이 지금 가장 중요하다.",
            "내면을 돌아보면서 자신을 정비하는 시간이다.",
            "서두르지 말고 여유를 가지면 길이 보인다.",
        ],
    },
    "흉": {
        "work": [
            "한 발 물러서서 상황을 살핀 후에 움직여라.",
            "큰 결정은 보류하고 상황이 나아지기를 기다려라.",
            "손실을 최소화하는 방향으로 행동을 조절하라.",
            "위험을 피해 우회하는 것이 현명한 선택이다.",
            "무리하게 추진하면 더 큰 손해를 볼 수 있다.",
            "보수적으로 접근하면서 리스크를 줄여나가라.",
            "안전을 최우선으로 생각하고 신중하게 움직여라.",
            "리스크를 줄이는 것이 지금 가장 중요하다.",
        ],
        "relation": [
            "다툼에 끼어들지 말고 거리를 두는 것이 낫다.",
            "말조심을 하고 불필요한 대화를 줄여라.",
            "혼자 있는 것이 사람으로 인한 화를 피하는 길이다.",
            "오해가 생기지 않도록 말과 행동을 조심하라.",
            "거리를 두고 지켜보면서 상황 변화를 기다려라.",
            "속마음을 드러내면 이용당할 수 있으니 조심하라.",
            "갈등을 피해 물러나면 더 큰 화를 면할 수 있다.",
            "불필요한 대화를 줄이고 침묵을 유지하라.",
        ],
        "inner": [
            "감정에 휘둘리지 말고 이성적으로 판단하라.",
            "충동적인 결정은 피하고 신중하게 생각하라.",
            "인내심을 발휘하면 어려운 시간도 지나간다.",
            "욕심을 버리면 마음이 편안해지고 길이 보인다.",
            "겸손하게 낮추면 주변의 도움을 받을 수 있다.",
            "마음을 다스리면 상황을 객관적으로 볼 수 있다.",
            "집착을 내려놓으면 새로운 가능성이 열린다.",
            "차분하게 생각하면 최선의 방법을 찾을 수 있다.",
        ],
    },
    "대흉": {
        "work": [
            "어떤 새로운 시작도 하지 않는 것이 최선이다.",
            "완전히 멈추고 상황이 지나가기를 기다려라.",
            "손대지 않는 것이 유일한 정답이니 참아라.",
            "모든 일을 중단하고 완전히 물러서라.",
            "후퇴하는 것만이 지금 살아남는 길이다.",
            "어떤 결정도 내리지 말고 시간이 해결하게 둬라.",
            "철저히 수비하면서 위기가 지나가기를 기다려라.",
            "최악의 상황에 대비하며 마음을 단단히 먹어라.",
        ],
        "relation": [
            "누구와도 약속하지 말고 혼자 지내는 것이 안전하다.",
            "모든 다툼에서 물러나고 침묵을 유지하라.",
            "입을 닫고 있으면 화를 면할 수 있다.",
            "혼자 있는 것이 지금 가장 안전한 선택이다.",
            "연락을 끊고 완전히 거리를 두는 것이 좋다.",
            "어느 편도 들지 말고 중립을 유지하라.",
            "사람을 멀리하면 사람으로 인한 화를 피한다.",
            "침묵하고 기다리는 것이 최선의 방법이다.",
        ],
        "inner": [
            "모든 욕심을 버리면 마음이 편안해진다.",
            "집착을 놓아야 새로운 길이 열린다.",
            "마음을 완전히 비우면 고통에서 벗어난다.",
            "체념하고 받아들이는 것이 지혜로운 때다.",
            "무(無)의 상태로 돌아가면 평화를 찾는다.",
            "기대를 접으면 실망할 일도 없어진다.",
            "오직 인내하고 기다리는 것만이 유일한 답이다.",
            "버티고 견디는 것만이 지금 할 수 있는 최선이다.",
        ],
    },
}


def generate_fortune_variation(yao_data: dict, theme: str) -> dict:
    """
    하나의 효 데이터로 특정 테마의 운세 생성

    Args:
        yao_data: YAO_DATA의 효 정보
        theme: "work" | "relation" | "inner"

    Returns:
        {"headline": "...", "body": "..."}
    """
    category = yao_data.get("fortune_category", "평")
    if category not in HEADLINE_TEMPLATES:
        category = "평"

    # 대제목 선택
    headline_list = HEADLINE_TEMPLATES[category].get(theme, HEADLINE_TEMPLATES[category]["work"])
    headline = random.choice(headline_list)

    # 본문 첫 문장 선택
    first_list = BODY_FIRST_TEMPLATES.get(category, BODY_FIRST_TEMPLATES["평"])
    first_sentence = random.choice(first_list)

    # 본문 두 번째 문장 선택
    second_templates = BODY_SECOND_TEMPLATES.get(category, BODY_SECOND_TEMPLATES["평"])
    second_list = second_templates.get(theme, second_templates["work"])
    second_sentence = random.choice(second_list)

    body = f"{first_sentence} {second_sentence}"

    return {
        "headline": headline,
        "body": body
    }


def generate_all_fortunes() -> dict:
    """
    모든 384효에 대해 3개 변형씩 생성

    Returns:
        {(괘번호, 효위치): [v1, v2, v3], ...}
    """
    all_fortunes = {}
    themes = ["work", "relation", "inner"]

    for (hexagram_num, yao_pos), yao_data in YAO_DATA.items():
        variations = []
        for theme in themes:
            fortune = generate_fortune_variation(yao_data, theme)
            variations.append(fortune)
        all_fortunes[(hexagram_num, yao_pos)] = variations

    return all_fortunes


def format_for_python(fortunes: dict) -> str:
    """
    Python 코드 형식으로 포맷팅
    """
    lines = []
    lines.append('"""')
    lines.append('일간운세 해석문 데이터 (자동 생성)')
    lines.append('')
    lines.append('이 파일은 generate_daily_fortune.py로 자동 생성되었습니다.')
    lines.append('수정이 필요하면 스크립트를 수정 후 재생성하세요.')
    lines.append('"""')
    lines.append('')
    lines.append('from typing import Dict, List, Tuple')
    lines.append('')
    lines.append('DAILY_FORTUNE: Dict[Tuple[int, int], List[Dict[str, str]]] = {')

    # 괘 순서대로 정렬
    sorted_keys = sorted(fortunes.keys(), key=lambda x: (x[0], x[1]))

    current_hexagram = None
    for key in sorted_keys:
        hexagram_num, yao_pos = key
        variations = fortunes[key]

        # 새 괘 시작시 주석 추가
        if current_hexagram != hexagram_num:
            if current_hexagram is not None:
                lines.append('')
            lines.append(f'    # 제{hexagram_num}괘')
            current_hexagram = hexagram_num

        lines.append(f'    ({hexagram_num}, {yao_pos}): [')
        for v in variations:
            headline = v["headline"].replace('"', '\\"')
            body = v["body"].replace('"', '\\"')
            lines.append('        {')
            lines.append(f'            "headline": "{headline}",')
            lines.append(f'            "body": "{body}"')
            lines.append('        },')
        lines.append('    ],')

    lines.append('}')
    lines.append('')

    # 헬퍼 함수 추가
    lines.append('')
    lines.append('def get_daily_fortune(hexagram_number: int, yao_position: int, variation: int = 0) -> Dict[str, str]:')
    lines.append('    """일간운세 해석문 조회"""')
    lines.append('    key = (hexagram_number, yao_position)')
    lines.append('    if key not in DAILY_FORTUNE:')
    lines.append('        return {')
    lines.append('            "headline": "오늘 하루도 순조롭게",')
    lines.append('            "body": "평온한 마음으로 하루를 보내라. 작은 일에 감사하며 성실히 임하면 좋은 결과가 따른다."')
    lines.append('        }')
    lines.append('    fortunes = DAILY_FORTUNE[key]')
    lines.append('    idx = variation % len(fortunes)')
    lines.append('    return fortunes[idx]')
    lines.append('')
    lines.append('')
    lines.append('def get_random_daily_fortune(hexagram_number: int, yao_position: int) -> Dict[str, str]:')
    lines.append('    """랜덤하게 변형 선택하여 일간운세 반환"""')
    lines.append('    import random')
    lines.append('    variation = random.randint(0, 2)')
    lines.append('    return get_daily_fortune(hexagram_number, yao_position, variation)')
    lines.append('')

    return '\n'.join(lines)


def main():
    print("=" * 60)
    print("Daily Fortune Generation Start")
    print("=" * 60)

    # 기존 데이터 확인
    print(f"\n[OK] YAO_DATA loaded: {len(YAO_DATA)} yao entries")

    # 생성
    print("\n[...] Generating 384 yao x 3 variations = 1,152 fortunes...")
    all_fortunes = generate_all_fortunes()
    print(f"[OK] Generated: {len(all_fortunes)} yao x 3 variations")

    # 파일 저장
    output_path = os.path.join(
        os.path.dirname(__file__),
        '..',
        'app',
        'data',
        'daily_fortune_generated.py'
    )
    output_path = os.path.abspath(output_path)

    content = format_for_python(all_fortunes)

    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(content)

    print(f"\n[OK] File saved: {output_path}")

    # 통계
    total_variations = sum(len(v) for v in all_fortunes.values())
    print(f"\n[Stats]")
    print(f"   - Total yao: {len(all_fortunes)}")
    print(f"   - Total fortunes: {total_variations}")
    print(f"   - Variations per yao: 3")

    print("\n" + "=" * 60)
    print("Generation Complete!")
    print("=" * 60)


if __name__ == "__main__":
    main()
