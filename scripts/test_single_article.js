/**
 * Test single article with updated Ollama prompt
 */

const articles = [
  {
    id: 1,
    title: "Short (191 chars) - Yeongam",
    content: `영암군 명도수산(대표 조병제)이 22일 미암면 마을회관과 경로당에 400만원 상당의 곱창김을 전달했다.
.
지난해 같은 곳에 20kg들이 쌀 100포대 전달에 이은 이번 나눔으로 명도수산은 연말을 맞는 어르신들에게 훈훈한 마음을 전했다.
조 대표는 "입맛이 떨어지는 계절, 어르신들이 김을 밑반찬으로 건강하게 겨울을 나시길 바란다"고 전했다.`
  },
  {
    id: 2,
    title: "Short-Medium (491 chars) - Gwangju Edu",
    content: `이번 협약은 내년 3월부터 전면 시행되는 학생맞춤통합지원(이하 학맞통)에 앞서 전문성을 갖춘 퇴직 교원 50명을 학생 지도인력(활동가)으로 투입해 교육 지원의 질을 높이고 체계적인 학생 맞춤형 지원 기반을 다지고자 마련됐다.
협약에 따라 두 기관은 학교 현장 안착을 돕는 '활동가' 지원사업의 세부 운영계획을 수립하고, 우수 인력 채용, 현장 대응력 강화 직무연수 등을 추진한다.
광주서부교육지원청은 퇴직 교원 활용으로 전문성이 강화되고 연간 4억원 상당의 예산이 절감될 것으로 기대하고 있다.
또 활동가와 학교 교사가 유기적으로 협력하고 소통해 학생들의 학습권 보장은 물론 정서적 안정을 도모할 계획이다.
광주서부교육지원청 이성철 교육장은 "협약을 통해 교육 예산의 한계를 극복하고 학생들에게 실질적인 도움을 줄 수 있는 상생 모델을 구축했다"며 "퇴직 교원의 풍부한 교육 경험을 바탕으로 학생 맞춤형 지도의 전문성을 더해 학생들이 배움의 즐거움을 느끼도록 하겠다"고 말했다.`
  },
  {
    id: 3,
    title: "Medium (595 chars) - Gangjin",
    content: `성전면 청년회 50만원, 명동마을 조병곤씨 100만원 기탁
성전면 청년회와 성전면 명동마을에 거주하는 조병곤씨가 도움이 필요한 주민들을 위해 사용해 달라며 총 성전면 지역사회보장협의체에 이웃돕기 성금을 기탁했다.
이번 기부에는 성전면 청년회가 50만 원, 조병곤 씨가 100만 원을 각각 전달했다.
성전면 청년회와 조병곤 씨는 매년 꾸준히 성금을 기탁하며 지역사회를 위한 나눔을 실천해 주위를 훈훈하게 하고 있다. 기탁된 성금은 사회복지공동모금회와 연계해 복지 소외계층 긴급지원, 저소득층 주거환경 개선 등 지역 내 어려운 이웃들을 돕는 데 쓰일 예정이다.
이영수 성전면 청년회장은 "앞으로도 지역의 청년들이 함께 나눔에 동참해 더 살기 좋은 성전면을 만드는 데 기여하고 싶다"고 말했다.
명동마을 조병곤 씨는 "추운 겨울 어려운 이웃들에게 조금이나마 도움이 되길 바라는 마음에서 기부하게 됐다"며 "앞으로도 꾸준한 나눔을 통해 행복한 지역사회 만들기에 보탬이 되고 싶다"고 말했다.
오명종 성전면장은 "오랜 시간 동안 나눔을 실천해 주신 성전면 청년회와 조병곤 씨께 깊이 감사드린다"며 "우리 지역에 소외된 이웃이 없도록 세심히 살피며 지원하겠다"고 밝혔다.
*`
  },
  {
    id: 4,
    title: "Medium-Long (774 chars) - Gangjin",
    content: `양 산림조합 임직원 20여 명 뜻 모아…"상생협력 의지 재확인"
강진군산림조합과 진도군산림조합 임직원들이 지난 11일 진도군청에서 고향사랑기부금 210만원을 상호 지역에 기부했다.
이번 상호기부는 윤길식 강진군산림조합 조합장, 허용범 진도군산림조합 조합장이 참여하여 각 조합 임직원 20여 명의 뜻을 모아 고향사랑기부제도 시행 첫해부터 3년 연속으로 두 지역의 상생협력 의지를 다졌다.
윤길식 강진군산림조합 이사장은 "고향사랑기부로 강진과 진도의 신뢰와 연대를 재확인했다"며 "두 지역사회가 상생 발전하는 2026년 한 해가 되길 희망한다"고 말했다.
강진원 강진군수는 "고향사랑기부제 활성화를 위해 동참해주신 윤길식 강진 조합장님, 허용범 진도 조합장님과 산림조합 임직원분들께 감사드린다"며 "붉은 말띠의 해에도 사람유두종 바이러스 예방접종 지원 등에 소중한 기부금이 잘 쓰이도록 말처럼 달리겠다"고 말했다.
2025년 고향사랑 기금사업 '홀로사는 노인을 위한 클린-업'이 읍면 복지회관 빨래방 설치, 경로당 노후 에어컨, 냉장고 교체를 내용으로 추진 중이다.
강진 고향사랑기부제는 기부금의 10만 원까지는 전액, 10만 원 초과분은 16.5%의 세액공제 혜택이 주어지며, 기부금액의 30% 이내에 해당하는 답례품이 제공된다. 강진군 고향사랑기부제 참여를 희망하면 포털 사이트에서 '고향사랑기부제'를 검색 후 고향사랑이음 사이트에서 온라인으로 기부하거나, 전국 농협에서 대면으로 기부하면 된다. 궁금한 사항은 강진군청 총무과(061-430-3708, 3592)로 문의하면 된다.
*`
  },
  {
    id: 5,
    title: "Long (1024 chars) - Gangjin",
    content: `미래 축산업 주역 위한 현장중심 교육 강화
한우산업 분야에서 종사하고 있는 강진군 청년 한우 농업인들이 지난 15일부터 16일까지 2일간 경남‧경북 지역의 한우산업 선진지 견학을 다녀왔다.
이번 견학은 한우산업의 최신 기술과 우수 경영사례를 직접 체험함으로써 청년 농업인의 실무 역량을 강화하고, 지역 축산업의 미래를 이끌어갈 인재를 양성하기 위한 목적으로 마련됐다.
견학 대상은 강진군에서 한우 사육을 시작했거나 계획중인 청년 농업인 30여 명으로 구성 됐으며, 한우 사육 및 유통 분야에서 선도적인 평가를 받고 있는 축산 관련 기관을 방문했다.
견학 일정은 생산 현장부터 출하, 유통까지 전 과정을 아우르는 형태로 구성돼 실질적인 현장 학습이 가능하도록 기획됐다.
참가자들은 ICT를 활용한 스마트 축사 운영 시스템, 송아지 질병 예방 및 개체별 건강관리 사례, 사료 효율 극대화를 위한 사양 관리 기법 등을 실시간으로 접하면서 최신 축산 기술의 흐름을 파악할 수 있었다. 특히 한우 개량과 혈통 관리의 중요성, 고급육 생산을 위한 브랜드화 전략에 대한 교육도 함께 이뤄져 청년들의 큰 호응을 얻었다.
강진군은 한우산업을 지역 핵심동력으로 육성하기 위해 한우 사육, 운반, 육가공, 유통, 조사료 생산 등 한우산업 분야에 1년 이상 종사하고 있는 45세 이하 청년 한우 농업인을 대상으로 전문 교육비, 자격증 취득비, 선진지 견학 등 한우산업 선진화와 경쟁력 강화를 위한 청년 농업인 네트워크 지원사업을 시행하고 있다.
강진원 강진군수는 "한우산업의 지속적인 발전을 위해서는 청년 농업인의 역할이 매우 중요 하다"며 "이번 견학을 통해 청년들이 현장의 노하우를 체득하고, 강진 한우의 미래를 이끌 핵심 인재로 성장하길 기대한다"고 밝혔다.
강진군은 청년 한우 농업인을 위한 현장 중심의 교육과 기술 지원을 확대하고, 고급육 생산 체계 정착을 통해 '강진 한우' 경쟁력을 높이는 데 주력할 방침이다. 이를 통해 강진군 한우산업의 경쟁력을 한층 강화하고, 청년이 돌아오는 지속 가능한 농촌 구현에 한 걸음 더 다가갈 계획이다.
*`
  }
];

function buildPrompt(content) {
  const inputLength = content.length;
  const minOutputLength = Math.floor(inputLength * 0.7);
  let lengthGuidance = '';

  if (inputLength < 500) {
    lengthGuidance = '[짧은 보도자료] 리드 문단(핵심 팩트) -> 세부 내용';
  } else if (inputLength < 1500) {
    lengthGuidance = '[중간 보도자료] 리드 문단 -> 구조화된 정보(■) -> 인용구(있으면)';
  } else {
    lengthGuidance = '[긴 보도자료] 리드 문단 -> 소제목별 내용 -> 인용구';
  }

  return {
    prompt: `# Role
당신은 정부·공공기관의 보도자료만을 바탕으로 문장을 다듬고 재구성하는 전문 편집자입니다.
광주광역시와 전라남도 지역 현안에 정통한 20년 경력의 지역 일간지 편집국장으로서,
보도자료 내용을 벗어나지 않는 리라이팅·형식 정리에만 한정하여 작업합니다.

---

# 절대 규칙 (위반 시 작성 중단)

## 1. 팩트 기반 원칙 (Source Truth Only)
- 제공된 보도자료에 명시된 사실(수치, 장소, 인물명, 날짜, 인용구)만 사용한다.
- 원본에 없는 숫자, 통계, 분석, 전망을 절대 추가하지 않는다.
- "~할 것으로 보인다", "~전망이다", "~기대된다" 등 추측성 표현을 사용하지 않는다.
- 출처가 불분명하거나 기억에 의존해야 하는 내용은 작성하지 않는다.

## 2. 모르면 모른다고 표시
- 보도자료에 없는 정보가 필요하면 해당 부분을 작성하지 않는다.
- 추측, 추정, 일반 상식에 근거한 보충 설명을 하지 않는다.
- 이 지침을 어겨야만 답변할 수 있는 경우, "작성 생략(할루시네이션 위험)"이라고 표시한다.

## 3. 숫자·고유명사 원문 유지
- 보도자료의 숫자·고유명사(기관명, 사업명, 날짜, 금액, 인원 등)는 원문과 완전히 동일하게 유지한다.
- 약어를 새로 만들거나 확장하지 않는다.
- 표현은 자연스럽게 다듬되, 사실 구조(누가·언제·어디서·무엇을·왜·어떻게)는 원문과 다르게 재해석하지 않는다.

## 4. 인용문 규칙
- 인용문(" ")은 보도자료에 있는 내용만 사용한다.
- 존재하지 않는 발언을 지어내지 않는다.
- 보도자료에 인용문이 없으면 인용문 없이 작성한다.

## 5. 금지 영역 (작성 금지)
- 배경 설명, 과거 이력, 다른 기관 언급 등 보도자료에 없는 맥락 추가 금지
- 정책·제도·규정의 해석 금지 (보도자료에 적힌 문장을 구조만 바꿔서 전달)
- 최신 현황이나 외부 통계 제공 금지

## 6. 길이 유지 원칙 (매우 중요!)
- 원본 길이: ${inputLength}자
- 최소 출력 길이: ${minOutputLength}자 이상 (원본의 70% 이상)
- 본문 구조: ${lengthGuidance}
- 원본의 모든 중요 정보를 포함해야 한다. 요약하지 말고 재구성하라.

---

# 출력 형식

## 부제목 (첫 줄에 반드시 작성)
[부제목: 핵심 내용 한 문장 요약]

## 본문 구조
- 리드 문단: 핵심 팩트 2~3문장
- 본문: 상세 내용 (■ 기호로 정보 구조화)
- 인용구: 원본에 있는 경우만

## 정보 구조화 예시
<p>■ 신청 기간: 2024년 12월 2일 ~ 12월 20일</p>
<p>■ 지원 대상: 만 18세 이상 39세 이하 청년</p>
<p>■ 지원 내용: 사업당 최대 500만원</p>

---

[보도자료]
${content}

[뉴스 기사]`,
    inputLength,
    minOutputLength
  };
}

async function testArticle(index) {
  const article = articles[index - 1];
  if (!article) {
    console.log('Invalid article index. Use 1-5.');
    return;
  }

  const { prompt, inputLength, minOutputLength } = buildPrompt(article.content);

  console.log(`\n${'='.repeat(70)}`);
  console.log(`TEST ${article.id}: ${article.title}`);
  console.log(`${'='.repeat(70)}`);
  console.log(`Input: ${inputLength} chars | Min Required: ${minOutputLength} chars (70%)`);
  console.log(`${'='.repeat(70)}`);

  const startTime = Date.now();

  try {
    const response = await fetch('http://localhost:11434/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'benedict/linkbricks-hermes3-llama3.1-8b-korean-advanced-q4',
        prompt: prompt,
        stream: false
      })
    });

    const data = await response.json();
    const output = data.response || '';
    const elapsed = Date.now() - startTime;

    const ratio = (output.length / inputLength * 100).toFixed(1);
    const passed = output.length >= minOutputLength;
    const grade = passed ? (ratio >= 100 ? 'A' : 'B') : (output.length >= inputLength * 0.5 ? 'C' : 'D');

    console.log(`\n[RESULT]`);
    console.log(`Output: ${output.length} chars | Ratio: ${ratio}%`);
    console.log(`Grade: ${grade} | Status: ${passed ? 'PASS' : 'FAIL'}`);
    console.log(`Time: ${(elapsed/1000).toFixed(1)}s`);
    console.log(`\n[OUTPUT]`);
    console.log('-'.repeat(70));
    console.log(output);
    console.log('-'.repeat(70));

  } catch (error) {
    console.log(`Error: ${error.message}`);
  }
}

// Get article index from command line
const articleIndex = parseInt(process.argv[2]) || 1;
testArticle(articleIndex);
