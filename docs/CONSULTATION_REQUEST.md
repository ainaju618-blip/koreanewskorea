# 코리아뉴스 전국판 - 디자인 및 기술 자문의뢰서

> **문서 버전:** 1.0
> **작성일:** 2026-01-04
> **의뢰 기관:** 코리아뉴스
> **연락처:** [연락처 기입]

---

## 1. 프로젝트 개요

### 1.1 프로젝트명
**코리아뉴스 전국판 (koreanewskorea.com)**

### 1.2 프로젝트 목적
대한민국 전국 17개 시/도, 250개 이상의 시/군/구를 아우르는 **지역 밀착형 뉴스 포털**을 구축하고자 합니다.

기존 지역 언론의 한계를 넘어, **IP 기반 자동 지역 감지**와 **인터랙티브 전국 지도**를 통해 사용자에게 맞춤형 지역 뉴스를 제공하는 것이 핵심 목표입니다.

### 1.3 핵심 컨셉

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│   🏛️ 본사 (전국판) koreanewskorea.com                                       │
│   ────────────────────────────────────                                       │
│   • 전국 뉴스 (정부/부처 보도자료)                                           │
│   • 전국 여행정보                                                            │
│   • 전국 지도 → 클릭 시 해당 지역으로 이동                                   │
│                                                                              │
│   📍 지사 (지역판) - IP 기반 자동 지역 감지                                  │
│   ────────────────────────────────────                                       │
│   • 해당 지역의 모든 콘텐츠를 한 화면에 통합 제공                            │
│   • 시정소식, 의회소식, 교육소식, 여행정보, 먹거리, 문화유적 등              │
│                                                                              │
│   예) 나주 IP 접속 시:                                                       │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  🏛️ 나주시정소식    │  🏫 나주교육소식    │  🗳️ 나주의회소식         │   │
│   │  🗺️ 나주여행정보    │  🍜 나주먹거리      │  🏛️ 나주문화유적지        │   │
│   │  📰 나주일상소식    │  🧭 네비 바로가기   │  📅 나주행사일정          │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.4 타겟 사용자
- **1차 타겟**: 지역 주민 (해당 지역 정보에 관심 있는 거주자)
- **2차 타겟**: 여행자 (지역 관광정보, 맛집 탐색)
- **3차 타겟**: 지역 공무원, 언론인, 연구자

### 1.5 차별화 포인트
| 기존 지역 뉴스 사이트 | 코리아뉴스 전국판 |
|---------------------|------------------|
| 단일 지역만 서비스 | 전국 250+ 지역 통합 |
| 수동으로 지역 선택 | IP 기반 자동 감지 |
| 뉴스 중심 | 뉴스 + 생활정보 통합 포털 |
| 정적 페이지 | 인터랙티브 지도 기반 탐색 |

---

## 2. 현재 시스템 현황

### 2.1 기술 스택

| 구분 | 기술 | 버전/상세 |
|------|------|----------|
| **프레임워크** | Next.js | 15.x (App Router) |
| **언어** | TypeScript | 5.x |
| **스타일링** | Tailwind CSS | 3.x |
| **UI 라이브러리** | shadcn/ui | 최신 |
| **데이터베이스** | Supabase (PostgreSQL) | - |
| **배포** | Vercel | - |
| **컴포넌트 설계** | Atomic Design | atoms/molecules/organisms/templates |

### 2.2 구현 완료된 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| 전국 행정구역 데이터 | ✅ 완료 | 17개 시/도, 250+ 시/군/구 JSON 데이터 |
| 지역 라우팅 구조 | ✅ 완료 | `/region/[sido]/[sigungu]/[articleId]` 4단계 |
| 타입 정의 | ✅ 완료 | TypeScript 인터페이스 |
| 지역 유틸 함수 | ✅ 완료 | 지역 검색, 매핑, 경로 생성 |
| Atomic Design 컴포넌트 | ✅ 완료 | Button, Badge, Card, Breadcrumb 등 |
| 라우팅 페이지 | ✅ 완료 | 4개 단계별 페이지 |
| Supabase region 컬럼 | ✅ 완료 | sido_code, sigungu_code 추가 |
| IP→지역 매핑 API | ✅ 완료 | 전국 17개 시도 + 250+ 시군구 지원 |
| 지역 선택 UI | ✅ 완료 | 계단식 드롭다운 (시/도 → 시/군/구) |
| 전국 지도 컴포넌트 | ✅ 완료 | 인터랙티브 SVG 지도 (17개 지역) |

### 2.3 구현 예정 기능

| 기능 | 우선순위 | 설명 |
|------|---------|------|
| 본사 메인 페이지 | P0 | 전국 뉴스 + 지도 중심 레이아웃 |
| 지역별 메인 페이지 | P0 | 9개 섹션 통합 (시정, 의회, 교육 등) |
| IP 감지 미들웨어 | P1 | 자동 지역 감지 및 리다이렉트 |
| 헤더/푸터 | P1 | 전역 네비게이션 |
| 여행정보 연동 | P2 | 한국관광공사 API |
| 네비게이션 연동 | P2 | 카카오맵/네이버맵 길찾기 |
| 날씨 위젯 | P3 | 기상청 API |

### 2.4 현재 데이터 현황

| 데이터 | 수량 | 소스 |
|--------|------|------|
| 전국 뉴스 (정책브리핑) | 10건 | korea.kr 스크래퍼 |
| 지역 뉴스 (광주/전남) | 약 500건 | 지자체 보도자료 스크래퍼 |
| 행정구역 데이터 | 250+ | 행정안전부 공개 데이터 |

### 2.5 파일 구조 (현재)

```
src/
├── app/
│   └── region/                    # 전국판 지역 라우팅
│       ├── page.tsx               # 17개 시/도 목록
│       ├── [sido]/
│       │   ├── page.tsx           # 시/도별 뉴스 + 시/군/구 목록
│       │   └── [sigungu]/
│       │       ├── page.tsx       # 시/군/구별 뉴스 목록
│       │       └── [articleId]/
│       │           └── page.tsx   # 기사 상세
│
├── components/
│   ├── atoms/                     # Button, Badge, Spinner 등
│   ├── molecules/                 # RegionCard, NewsCard, Breadcrumb, RegionSelector
│   ├── organisms/                 # RegionGrid, NewsList, KoreaMap
│   └── templates/                 # (예정)
│
├── data/
│   └── regions.json               # 전국 행정구역 데이터
│
├── lib/
│   ├── national-regions.ts        # 지역 유틸 함수
│   ├── geolocation.ts             # IP 기반 지역 감지
│   └── utils.ts                   # 공통 유틸
│
└── types/
    └── regions.ts                 # 지역 타입 정의
```

---

## 3. 자문 요청 사항

### 3.1 UI/UX 디자인 자문

#### 3.1.1 메인 페이지 (본사 - 전국판)
**현재 고민:**
- 전국 지도를 메인 히어로 영역에 배치할지, 뉴스 목록과 병렬 배치할지
- 전국 뉴스와 지역 진입점의 균형
- 첫 방문자가 직관적으로 "내 지역"을 찾을 수 있는 UX

**질문:**
1. 뉴스 포털의 히어로 섹션에서 지도 중심 vs 뉴스 중심, 어떤 접근이 더 효과적일까요?
2. 17개 시/도를 한눈에 보여주면서도 클릭 유도가 잘 되는 지도 디자인 방향은?
3. 모바일에서 지도 인터랙션의 best practice는?

#### 3.1.2 지역 메인 페이지 (지사 - 지역판)
**현재 고민:**
- 9개 섹션(시정, 의회, 교육, 여행, 먹거리, 문화, 일상, 행사, 날씨)의 배치 우선순위
- 카드형 vs 리스트형 레이아웃
- 정보 과부하 없이 풍부한 콘텐츠를 보여주는 방법

**질문:**
1. 지역 포털에서 가장 먼저 보여줘야 할 콘텐츠는 무엇일까요?
2. 섹션 간 시각적 구분과 통일성을 동시에 달성하는 디자인 패턴은?
3. "지역 생활 포털" 느낌을 주는 UI 요소나 색상 전략은?

#### 3.1.3 디자인 시스템
**현재 상황:**
- Tailwind CSS + shadcn/ui 사용 중
- Atomic Design 패턴 적용

**질문:**
1. 뉴스/미디어 사이트에 적합한 색상 팔레트 추천 (신뢰감 + 현대적)
2. 한국어 콘텐츠에 최적화된 타이포그래피 시스템 (폰트, 크기, 행간)
3. 뉴스 카드 컴포넌트의 이상적인 비율과 정보 배치

### 3.2 기술 구현 자문

#### 3.2.1 성능 최적화
**현재 고민:**
- 250+ 지역 × 다수 섹션 = 대량의 페이지
- 초기 로딩 속도와 SEO 최적화

**질문:**
1. Next.js App Router에서 대량의 동적 라우트 최적화 전략은?
2. ISR (Incremental Static Regeneration) vs SSR vs SSG, 뉴스 사이트에 가장 적합한 전략은?
3. 이미지 최적화 및 CDN 전략 권장사항은?

#### 3.2.2 데이터 구조
**현재 상황:**
- Supabase PostgreSQL 사용
- posts 테이블에 sido_code, sigungu_code 컬럼 추가

**질문:**
1. 지역별 콘텐츠 쿼리 최적화를 위한 인덱싱 전략은?
2. 실시간 업데이트가 필요한 데이터(날씨, 교통)의 캐싱 전략은?
3. 향후 확장성을 고려한 테이블 설계 권장사항은?

#### 3.2.3 IP 기반 지역 감지
**현재 상황:**
- ip-api.com 무료 API 사용 (1분당 45요청 제한)
- 클라이언트 IP → 시/도 + 시/군/구 매핑

**질문:**
1. 프로덕션 환경에서 추천하는 GeoIP 서비스는? (정확도, 비용, 한국 지원)
2. VPN/프록시 사용자 처리 전략은?
3. 지역 감지 실패 시 fallback UX 권장사항은?

### 3.3 사업 전략 자문 (선택)

#### 3.3.1 수익화
**질문:**
1. 지역 뉴스 포털의 효과적인 광고 배치 위치와 형식은?
2. 지역 사업자 대상 스폰서십/제휴 모델 가능성은?
3. 프리미엄 기능(알림, 맞춤 뉴스)의 유료화 가능성은?

#### 3.3.2 콘텐츠 확보
**질문:**
1. 지자체/공공기관 보도자료 외 콘텐츠 소스 확보 전략은?
2. UGC (User Generated Content) 도입 시 고려사항은?
3. 저작권 및 크롤링 관련 법적 고려사항은?

---

## 4. 참고 자료

### 4.1 유사 서비스 (벤치마킹 대상)

| 서비스 | URL | 참고 포인트 |
|--------|-----|-------------|
| 네이버 뉴스 | news.naver.com | 카테고리 구조, 레이아웃 |
| 다음 뉴스 | news.daum.net | 지역 뉴스 섹션 |
| 연합뉴스 | yonhapnews.co.kr | 속보 UI |
| 오마이뉴스 | ohmynews.com | 지역 리포터 모델 |
| 지역N | (지역 뉴스 플랫폼) | 지역 통합 모델 |

### 4.2 디자인 레퍼런스 요청
아래와 같은 스타일의 참고 사이트/이미지를 제안해주시면 감사하겠습니다:
- 모던 뉴스 포털 디자인
- 지도 기반 인터랙티브 웹사이트
- 한국 지역 포털 사이트
- 카드 기반 콘텐츠 레이아웃

### 4.3 기술 문서
- **Next.js 15 App Router 문서**: https://nextjs.org/docs
- **Tailwind CSS 문서**: https://tailwindcss.com/docs
- **shadcn/ui 문서**: https://ui.shadcn.com
- **Supabase 문서**: https://supabase.com/docs

---

## 5. 기대 결과물

### 5.1 디자인 자문
- [ ] 메인 페이지 와이어프레임 또는 레이아웃 제안
- [ ] 지역 페이지 섹션 배치 권장안
- [ ] 색상 팔레트 및 타이포그래피 가이드
- [ ] 모바일 반응형 디자인 가이드라인
- [ ] 참고할 만한 디자인 레퍼런스 목록

### 5.2 기술 자문
- [ ] 아키텍처 개선 제안
- [ ] 성능 최적화 체크리스트
- [ ] 데이터베이스 스키마 검토
- [ ] 보안 고려사항
- [ ] 확장성 로드맵

### 5.3 기타
- [ ] 우선순위 조정 제안
- [ ] 리스크 요인 및 대응 방안
- [ ] 예상 개발 공수 (선택)

---

## 6. 자문 진행 방식

### 6.1 희망 형식
- [ ] 서면 자문 (문서 회신)
- [ ] 화상 미팅 (Zoom/Google Meet)
- [ ] 대면 미팅
- [ ] 슬랙/디스코드 채널 협업

### 6.2 일정
- **자문 요청일**: 2026-01-04
- **희망 회신일**: 2026-01-__
- **개발 착수 예정**: 회신 후 즉시

### 6.3 비용
- 자문 비용 협의 가능
- 예산 범위: ________

---

## 7. 연락처

| 구분 | 정보 |
|------|------|
| 담당자 | |
| 이메일 | |
| 전화번호 | |
| 회사/조직 | 코리아뉴스 |

---

## 8. 첨부 파일

1. `MASTER_PLAN.md` - 전체 기획서
2. `NATIONAL_EDITION_IA.md` - IA/라우팅 상세 문서
3. `regions.json` - 전국 행정구역 데이터 샘플
4. 현재 컴포넌트 스크린샷 (필요시)

---

---

# 📦 [Part 2] 스크래퍼 기술 자문요청서

> **추가 작성일:** 2026-01-05
> **모듈명:** Enterprise Stealth v3.0 (전국 17개 시·도 보도자료 수집 시스템)
> **기술 스택:** Python, Playwright, playwright-stealth, Supabase, Cloudinary

---

## 9. 스크래퍼 프로젝트 개요

### 9.1 목적
전국 17개 광역시·도 지방자치단체의 **보도자료**를 자동 수집하여 koreanewskorea.com에 제공

### 9.2 대상 사이트 현황

| # | 지역 | 도메인 | 페이지 구조 | 테스트 상태 |
|---|------|--------|------------|-------------|
| 1 | 서울특별시 | news.seoul.go.kr | 리스트형 | 개발완료 |
| 2 | 부산광역시 | busan.go.kr | 리스트형 | 개발완료 |
| 3 | 대구광역시 | info.daegu.go.kr | **테이블형** | ✅ 완료 |
| 4 | 인천광역시 | incheon.go.kr | 리스트형 | 개발완료 |
| 5 | 광주광역시 | gwangju.go.kr | 리스트형 | 개발완료 |
| 6 | 대전광역시 | daejeon.go.kr | 리스트형 | 개발완료 |
| 7 | 울산광역시 | ulsan.go.kr | 리스트형 | 개발완료 |
| 8 | 세종특별자치시 | sejong.go.kr | 리스트형 | 개발완료 |
| 9 | 경기도 | gnews.gg.go.kr | 리스트형 | 개발완료 |
| 10 | 강원특별자치도 | gangwon.go.kr | 리스트형 | 개발완료 |
| 11 | 충청북도 | chungbuk.go.kr | 리스트형 | 개발완료 |
| 12 | 충청남도 | chungnam.go.kr | **중첩 리스트** | 🔄 테스트중 |
| 13 | 전북특별자치도 | jeonbuk.go.kr | 리스트형 | 개발완료 |
| 14 | 전라남도 | jeonnam.go.kr | 리스트형 | 개발완료 |
| 15 | 경상북도 | gb.go.kr | 리스트형 | 개발완료 |
| 16 | 경상남도 | gyeongnam.go.kr | 리스트형 | 개발완료 |
| 17 | 제주특별자치도 | jeju.go.kr | 리스트형 | ✅ 완료 |

### 9.3 기술 아키텍처

```
┌──────────────────────────────────────────────────────────────────┐
│                    Enterprise Stealth v3.0                        │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐   │
│  │ Playwright  │ → │ Stealth Plugin  │ → │ Page Scraping   │   │
│  │ Browser     │    │ (fingerprint)   │    │ (content)       │   │
│  └─────────────┘    └─────────────────┘    └─────────────────┘   │
│         ↓                   ↓                      ↓              │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐   │
│  │ Fingerprint │    │ BlockDetector   │    │ Content         │   │
│  │ Manager     │    │ (차단 감지)     │    │ Extractor       │   │
│  └─────────────┘    └─────────────────┘    └─────────────────┘   │
│         ↓                   ↓                      ↓              │
│  ┌─────────────┐    ┌─────────────────┐    ┌─────────────────┐   │
│  │ POMDP Delay │    │ Recovery        │    │ Cloudinary      │   │
│  │ Generator   │    │ Strategy        │    │ (이미지 업로드) │   │
│  └─────────────┘    └─────────────────┘    └─────────────────┘   │
│                            ↓                       ↓              │
│                    ┌─────────────────────────────────────┐       │
│                    │      Supabase (PostgreSQL)          │       │
│                    │      → posts 테이블 저장            │       │
│                    └─────────────────────────────────────┘       │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## 10. 🚨 발생한 주요 문제들 및 애로사항

### 10.1 BlockDetector 오탐지 문제 (Critical)

**증상:**
- 정상적인 정부 웹사이트에서 `BlockType.CAPTCHA` 감지
- 스크래핑이 즉시 중단되어 데이터 수집 불가

**원인 분석:**
```python
# enterprise_stealth.py의 BLOCK_PATTERNS (문제의 패턴)
BLOCK_PATTERNS = {
    BlockType.CAPTCHA: [
        r'captcha', r'recaptcha', r'hcaptcha',
        r'challenge', r'verify.*human', r'not.*robot',  # ← 이 패턴이 문제!
        r'security.*check', r'bot.*detect',
    ],
}
```

**문제 상황:**
- 정부 웹사이트의 일반 텍스트에 "robot", "verify" 등의 단어가 포함
- 실제 CAPTCHA가 없는데 CAPTCHA로 오인하여 중단

**현재 임시 해결책:**
```python
# IP_BAN과 RATE_LIMIT만 중단, 나머지(CAPTCHA, CLOUDFLARE)는 무시
if block_type in [BlockType.IP_BAN, BlockType.RATE_LIMIT]:
    # 중단 로직 실행
elif block_type != BlockType.NONE:
    print(f"[INFO] Ignoring false positive: {block_type}")
```

**❓ 자문 필요 질문:**
1. 정부 웹사이트 전용으로 BlockDetector 패턴을 어떻게 조정해야 하는가?
2. HTTP 응답 코드(403, 429 등) 기반 차단 감지가 더 신뢰성 있는가?
3. 오탐지와 실제 차단을 구분하는 정교한 방법이 있는가?
4. 정부 사이트에서 실제로 사용하는 차단 방식은 무엇인가?

---

### 10.2 CSS 셀렉터 불일치 문제 (High)

**증상:**
- "All selectors failed" 에러 빈발
- 한 사이트에서 작동하는 셀렉터가 다른 사이트에서 실패

**발견된 페이지 구조 유형:**

| 유형 | 예시 | HTML 구조 | 셀렉터 예시 |
|------|------|----------|------------|
| 테이블형 | 대구 | `<table><tbody><tr><td>` | `table tbody tr` |
| 리스트형 | 제주 | `<ul><li><a><strong>` | `ul li:has(a[href*="view"])` |
| 중첩 리스트 | 충남 | `<main><div><div><ul><li><a>` | `main li:has(a[href*="view.do"])` |
| 카드형 | 서울 | `<div class="card"><div>` | `.card, .news-item` |

**각 사이트별 셀렉터 조사 필요:**
```
대구: table tbody tr → 정상 작동
제주: ul li:has(a[href*="act=view"]) → 정상 작동
충남: main li:has(a[href*="view.do"]) → 조정 필요
기타: 테스트 필요
```

**❓ 자문 필요 질문:**
1. 동적으로 셀렉터를 탐지하는 자동화 방법이 있는가?
2. 셀렉터 우선순위를 어떻게 설정하는 것이 효율적인가?
3. 사이트 구조 변경 시 대응하는 모니터링/알림 시스템 권장사항?
4. XPath vs CSS Selector 중 정부 사이트에 더 안정적인 것은?

---

### 10.3 URL 파라미터 구성 오류 (Medium)

**증상:**
```
# 잘못된 URL 생성 (이중 물음표)
https://www.chungnam.go.kr/.../list.do?menuNo=500181?pageIndex=2
                                       ↑              ↑
                                   이미 있음       중복 발생!
```

**원인:**
- 각 사이트의 기본 URL에 이미 쿼리 파라미터 포함
- 페이지네이션 파라미터 추가 시 `?` vs `&` 구분 미흡

**현재 해결책:**
```python
if '?' in LIST_URL:
    list_url = f'{LIST_URL}&{PAGE_PARAM}={page_num}'
else:
    list_url = f'{LIST_URL}?{PAGE_PARAM}={page_num}'
```

**❓ 자문 필요 질문:**
1. Python `urllib.parse.urljoin`/`urlencode` 사용이 더 안전한가?
2. 각 사이트 페이지네이션 패턴 관리 모범 사례?

---

### 10.4 이미지 추출 실패 (IMAGE_MISSING) (Medium)

**증상:**
- 기사 본문은 정상 추출, 이미지 URL 미발견
- 브라우저에서 직접 확인 시 이미지 존재

**원인 분석:**
1. 이미지가 본문 셀렉터 범위 밖에 위치
2. JavaScript로 동적 로드되는 이미지 (lazy loading)
3. `<img>` 대신 `background-image` CSS 사용
4. 첨부파일 형태로 이미지 제공 (다운로드 링크)

**현재 이미지 추출 로직:**
```python
# 1차: 첨부파일 링크에서 이미지 확장자 찾기
attach_links = page.locator('a[href*="download"], a[href*="file"]')
for link in attach_links:
    if any(ext in title for ext in ['.jpg', '.png', '.gif']):
        # Cloudinary 업로드

# 2차: 본문 내 <img> 태그 탐색
for sel in CONTENT_SELECTORS:
    imgs = page.locator(f'{sel} img')
    # src 속성 추출
```

**❓ 자문 필요 질문:**
1. 정부 보도자료는 이미지 없는 경우가 많음 - IMAGE_MISSING을 에러로 처리해야 하는가?
2. lazy loading 이미지 대기 적절한 방법? (`page.wait_for_selector`?)
3. 아이콘/버튼 이미지 필터링 로직 권장사항?

---

### 10.5 날짜 형식 불일치 (Low)

**발견된 형식 다양성:**
```
2026.01.05          # 점 구분
2026-01-05          # 대시 구분
2026/01/05          # 슬래시 구분
2026년 01월 05일    # 한글 포함
20260105            # 구분자 없음
1월 5일             # 연도 없음
```

**현재 파싱 로직:**
```python
def normalize_date(date_str: str) -> str:
    date_str = date_str.replace('.', '-').replace('/', '-')
    match = re.search(r'(\d{4})[-./](\d{1,2})[-./](\d{1,2})', date_str)
    if match:
        y, m, d = match.groups()
        return f"{y}-{int(m):02d}-{int(d):02d}"
    return datetime.now().strftime('%Y-%m-%d')  # fallback
```

**❓ 자문 필요 질문:**
1. 한국어 날짜 형식 전용 파서 라이브러리 추천? (`dateparser`, `arrow`?)
2. 연도 없는 날짜 처리 정책? (현재 연도 가정?)

---

## 11. 🏗️ 아키텍처 관련 질문

### 11.1 Enterprise Stealth 모듈 적정 수준

**현재 구현된 기능:**
- POMDP 기반 지연 시간 생성 (Poisson 분포)
- 브라우저 핑거프린트 순환 (15분 간격)
- User-Agent 랜덤화
- 차단 감지 및 복구 전략
- playwright-stealth 플러그인

**질문:**
- 정부 웹사이트 스크래핑에 이 정도 수준의 스텔스가 필요한가?
- 정부 사이트는 일반적으로 차단 정책이 느슨한데, 오버엔지니어링 아닌가?
- 더 단순한 접근법(단순 requests + 고정 User-Agent)으로도 충분한가?

### 11.2 병렬 처리 vs 순차 처리

**현재:** 17개 스크래퍼가 순차적으로 실행

**고려 옵션:**
```python
# 옵션 A: 완전 순차 (현재)
for scraper in scrapers:
    scraper.collect_articles()

# 옵션 B: 병렬 처리 (ThreadPoolExecutor)
with ThreadPoolExecutor(max_workers=5) as executor:
    executor.map(lambda s: s.collect_articles(), scrapers)

# 옵션 C: 시간대 분산 (스케줄러)
schedule.every(10).minutes.do(run_random_scraper)
```

**질문:**
1. 정부 사이트 대상 병렬 스크래핑이 문제될 수 있는가?
2. 권장되는 요청 간격? (현재: 1.5~4초 랜덤)
3. 17개 사이트 전체 스크래핑 권장 주기? (현재: 3시간)

### 11.3 중복 체크 전략

**현재 로직:**
```python
# API 호출로 URL 기반 중복 체크
existing_urls = check_duplicates(urls_to_check)
new_items = [item for item in items if item['url'] not in existing_urls]
```

**문제점:**
- 매번 API 호출 발생 (네트워크 비용)
- URL 변경 시 중복 감지 실패 가능

**대안:**
1. 제목 + 날짜 해시로 중복 체크
2. 로컬 캐시 활용 (SQLite, Redis)
3. Bloom Filter 사용

**질문:** 대규모 스크래핑에서 중복 체크 모범 사례?

---

## 12. ⚡ 성능 및 안정성 질문

### 12.1 메모리 관리

**이슈:**
- Playwright 브라우저 인스턴스가 메모리를 많이 사용 (수백 MB)
- 장시간 실행 시 메모리 누수 가능성

**질문:**
1. 브라우저 컨텍스트 재사용 vs 매번 새로 생성?
2. 메모리 사용량 모니터링 방법?
3. OOM 방지 설정?

### 12.2 네트워크 오류 처리

**발생하는 오류:**
- `TimeoutError`: 페이지 로드 시간 초과
- `ConnectionError`: 네트워크 연결 실패
- `SSLError`: 인증서 문제 (일부 정부 사이트)

**현재 재시도 로직:**
```python
@retry_with_backoff(max_retries=3, base_backoff=2.0, max_backoff=30.0)
def safe_goto(page, url, timeout=20000):
    page.goto(url, wait_until='networkidle', timeout=timeout)
```

**질문:**
1. `wait_until` 옵션 중 어느 것이 가장 안정적?
   - `'load'`, `'domcontentloaded'`, `'networkidle'`
2. 타임아웃 값 최적화 방법?
3. 특정 사이트 반복 실패 시 스킵 정책?

### 12.3 로깅 및 모니터링

**현재:**
- 콘솔 출력 (print)
- API 호출로 서버에 상태 전송

**필요한 모니터링 지표:**
- 사이트별 성공/실패율
- 평균 수집 시간
- 이미지 추출률
- 차단 발생 빈도

**질문:** 추천하는 로깅/모니터링 도구?

---

## 13. 📊 데이터 품질 질문

### 13.1 본문 정제 (Content Cleaning)

**현재 처리:**
```python
def clean_article_content(text: str) -> str:
    # 특수문자, 과도한 공백 제거
    # HTML 태그 제거
    # 5000자 제한
```

**질문:**
1. 보도자료의 연락처/담당자 정보 처리 방법?
2. 표(table) 데이터 처리 방법?
3. 첨부파일 목록 - 본문 포함 vs 별도 필드?

### 13.2 카테고리 자동 분류

**현재:**
```python
def detect_category(title: str, content: str) -> Tuple[str, str]:
    # 키워드 기반 분류 (예: "코로나" → "보건의료")
```

**질문:**
1. 정부 보도자료 표준 카테고리 체계?
2. ML 기반 분류기 도입 가치?
3. 분류 정확도 측정 방법?

---

## 14. 🎯 우선순위 자문 요청

**가장 먼저 해결해야 할 문제:**

| 순위 | 문제 | 영향도 | 복잡도 | 현재 상태 |
|------|------|--------|--------|----------|
| 1️⃣ | BlockDetector 오탐지 | 높음 (수집 중단) | 중간 | 임시 해결 |
| 2️⃣ | CSS 셀렉터 불일치 | 높음 (데이터 누락) | 높음 | 사이트별 조사 중 |
| 3️⃣ | 이미지 추출 실패 | 중간 (품질 저하) | 중간 | 부분 해결 |
| 4️⃣ | 날짜 파싱 오류 | 낮음 (대체값) | 낮음 | 작동 중 |
| 5️⃣ | 성능 최적화 | 중간 (운영 비용) | 높음 | 미착수 |

---

## 15. 📎 첨부: 실제 로그 예시

### 정상 작동 로그 (대구)
```
============================================================
[대구광역시] 보도자료 스크래퍼 v3.0 (Enterprise Stealth)
============================================================
   [DATE] 2026-01-02 ~ 2026-01-05

   [PAGE] 페이지 1 수집 중...
      [DELAY] 2.34s
      [FOUND] 10개 항목
      [ARTICLE] 대구시, 2026년 신년 해맞이 행사 개최...
         [DELAY] 1.87s
         [OK] 저장 완료
      [ARTICLE] 대구시, 복지시설 점검 결과 발표...
         [DELAY] 2.15s
         [OK] 저장 완료

============================================================
SUMMARY REPORT for 대구광역시
============================================================
Processed: 10 | Success: 8 | Skipped: 2 (duplicates)
```

### 오류 발생 로그 (충남 - 수정 전)
```
============================================================
[충청남도] 보도자료 스크래퍼 v3.0 (Enterprise Stealth)
============================================================
   [DATE] 2026-01-02 ~ 2026-01-05

   [PAGE] 페이지 1 수집 중...
      [DEBUG] Page content length: 125432
      [DEBUG] Block type: BlockType.CAPTCHA    ← 오탐지!
      [WARN] Aborting due to block: BlockType.CAPTCHA

============================================================
ERROR REPORT for 충청남도
============================================================
Processed: 0 | Success: 0 | Skipped: 0
Error: BlockDetector false positive
```

### 셀렉터 실패 로그
```
[PAGE] 페이지 1 수집 중...
   [DEBUG] Calling wait_and_find...
   [ERROR] All selectors failed: ['ul.news_list > li', '.board-list li', ...]
   [DEBUG] wait_and_find returned: None
   [WARN] 기사 목록 없음
```

---

## 16. 📞 스크래퍼 관련 연락처

- **GitHub 저장소**: github.com/ainaju618-blip/koreanewskorea
- **Supabase 프로젝트 ID**: ebagdrupjfwkawbwqjjg
- **담당자 이메일**: ainaju618@gmail.com
- **스크래퍼 코드 위치**: `d:\cbt\koreanewskorea\scrapers\`

---

*본 자문의뢰서에 대한 문의사항이 있으시면 언제든 연락 부탁드립니다.*
*성실한 자문에 미리 감사드립니다.*
