<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <a href="/" class="text-xl font-bold text-blue-600">Claude Hub</a>
                    <div class="flex space-x-4">
                        <a href="/" class="text-blue-600 font-medium">Dashboard</a>
                        <a href="/library" class="text-gray-600 hover:text-blue-600">Library</a>
                        <a href="/projects" class="text-gray-600 hover:text-blue-600">Projects</a>
                    </div>
                </div>
                <div id="db-status" class="text-sm text-gray-500">
                    DB 확인 중...
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">전체 프로젝트</div>
                <div id="stat-projects" class="text-3xl font-bold text-blue-600">-</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">지식 항목</div>
                <div id="stat-knowledge" class="text-3xl font-bold text-green-600">-</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">전역 지식</div>
                <div id="stat-global" class="text-3xl font-bold text-purple-600">-</div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="text-sm text-gray-500 mb-1">토픽</div>
                <div id="stat-topics" class="text-3xl font-bold text-orange-600">-</div>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Projects Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <h2 class="text-lg font-semibold">프로젝트</h2>
                    <a href="/projects" class="text-sm text-blue-600 hover:underline">전체 보기</a>
                </div>
                <div id="projects-list" class="divide-y">
                    <div class="p-6 text-center text-gray-500">로딩 중...</div>
                </div>
            </div>

            <!-- Recent Knowledge Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <h2 class="text-lg font-semibold">최근 지식</h2>
                    <a href="/knowledge" class="text-sm text-blue-600 hover:underline">전체 보기</a>
                </div>
                <div id="knowledge-list" class="divide-y">
                    <div class="p-6 text-center text-gray-500">로딩 중...</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Check health
        fetch('/api/health')
            .then(r => r.json())
            .then(data => {
                const el = document.getElementById('db-status');
                if (data.database === 'connected') {
                    el.innerHTML = '<span class="text-green-600">DB 연결됨</span>';
                } else {
                    el.innerHTML = '<span class="text-red-600">DB 연결 안됨</span>';
                }
            })
            .catch(() => {
                document.getElementById('db-status').innerHTML = '<span class="text-red-600">오류</span>';
            });

        // Load projects
        fetch('/api/projects')
            .then(r => r.json())
            .then(data => {
                document.getElementById('stat-projects').textContent = data.count;
                const list = document.getElementById('projects-list');
                if (data.projects.length === 0) {
                    list.innerHTML = '<div class="p-6 text-center text-gray-500">프로젝트가 없습니다</div>';
                    return;
                }
                list.innerHTML = data.projects.slice(0, 5).map(p => `
                    <div class="px-6 py-4 hover:bg-gray-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium">${p.name}</div>
                                <div class="text-sm text-gray-500">${p.git_email}</div>
                            </div>
                            <span class="px-2 py-1 text-xs rounded ${p.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${p.status}
                            </span>
                        </div>
                    </div>
                `).join('');
            })
            .catch(() => {
                document.getElementById('projects-list').innerHTML = '<div class="p-6 text-center text-red-500">로드 실패</div>';
            });

        // Load knowledge stats
        fetch('/api/knowledge/stats')
            .then(r => r.json())
            .then(data => {
                document.getElementById('stat-knowledge').textContent = data.total || 0;
                document.getElementById('stat-global').textContent = data.by_scope?.global || 0;
                document.getElementById('stat-topics').textContent = Object.keys(data.by_topic || {}).length;
            })
            .catch(() => {});

        // Load recent knowledge
        fetch('/api/knowledge/recent?limit=5')
            .then(r => r.json())
            .then(data => {
                const list = document.getElementById('knowledge-list');
                if (!data.entries || data.entries.length === 0) {
                    list.innerHTML = '<div class="p-6 text-center text-gray-500">지식 항목이 없습니다</div>';
                    return;
                }
                list.innerHTML = data.entries.map(k => `
                    <div class="px-6 py-4 hover:bg-gray-50">
                        <div class="font-medium">${k.title}</div>
                        <div class="text-sm text-gray-500 mt-1 line-clamp-2">${k.summary?.split('\n')[0] || ''}</div>
                        <div class="flex gap-2 mt-2">
                            <span class="px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded">${k.scope}</span>
                            <span class="px-2 py-0.5 text-xs bg-gray-100 text-gray-800 rounded">${k.topic}</span>
                        </div>
                    </div>
                `).join('');
            })
            .catch(() => {
                document.getElementById('knowledge-list').innerHTML = '<div class="p-6 text-center text-red-500">로드 실패</div>';
            });
    </script>
</body>
</html>
